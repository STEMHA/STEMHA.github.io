<!DOCTYPE html>
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
<script type="text/javascript" src="/js/src/click.js"></script>
<script type="text/javascript" src="/live2d-widget/autolload.js"></script>

<!-- 数字雨-->
<canvas id="canvas" width="1440" height="900" ></canvas>
  <script type="text/javascript" src="/js/src/DigitalRain.js"></script> 

<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Linux文件系统注册、安装与卸载 - STEMHA&#39;s Blog</title>


    <meta name="description" content="概述 当内核被编译时，就已经确定了可以支持哪些文件系统，这些文件系统在系统引导时，在 VFS 中进行注册。如果文件系统是作为内核可装载的模块，则在实际安装时进行注册，并在模块卸载时注销。  VFS的初始化函数用来向VFS注册，即填写文件注册表file_system_type数据结构。每一个文件系统类型在注册表中有一个登记项，记录该文件系统的类型名、文件系统特性、指向对应的VFS超级块读取函数的地址">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux文件系统注册、安装与卸载">
<meta property="og:url" content="https://stemha.github.io/2020/08/16/Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%B3%A8%E5%86%8C%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/index.html">
<meta property="og:site_name" content="STEMHA&#39;s Blog">
<meta property="og:description" content="概述 当内核被编译时，就已经确定了可以支持哪些文件系统，这些文件系统在系统引导时，在 VFS 中进行注册。如果文件系统是作为内核可装载的模块，则在实际安装时进行注册，并在模块卸载时注销。  VFS的初始化函数用来向VFS注册，即填写文件注册表file_system_type数据结构。每一个文件系统类型在注册表中有一个登记项，记录该文件系统的类型名、文件系统特性、指向对应的VFS超级块读取函数的地址">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://stemha.github.io/images/og_image.png">
<meta property="article:published_time" content="2020-08-16T12:11:46.000Z">
<meta property="article:modified_time" content="2020-08-17T13:10:35.655Z">
<meta property="article:author" content="STEMHA">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="文件系统">
<meta property="article:tag" content="内核">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://stemha.github.io/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/pojoaque.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">

<link rel="alternate" href="/rss.xml" title="STEMHA's Blog" type="application/atom+xml">
</head>
<body class="is-2-column">
<!-- <body class="is-3-column"> -->
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/og_image.png" alt="Linux文件系统注册、安装与卸载" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">首页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
                <a class="navbar-item"
                href="/cs-quotes">CS语录</a>
                
                <a class="navbar-item"
                href="/rss.xml">RSS</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
               <!--<div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-08-16T12:11:46.000Z">2020-08-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    44 分钟 读完 (大约 6674 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Linux文件系统注册、安装与卸载
            
        </h1>
        <div class="content">
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a><strong>概述</strong></h2><blockquote>
<p>当内核被编译时，就已经确定了可以支持哪些文件系统，这些文件系统在系统引导时，在 VFS 中进行注册。如果文件系统是作为内核可装载的模块，则在实际安装时进行注册，并在模块卸载时注销。</p>
<ul>
<li>VFS的初始化函数用来向VFS注册，即填写<code>文件注册表file_system_type数据结构</code>。每一个文件系统类型在注册表中有一个登记项，记录该文件系统的类型名、文件系统特性、指向对应的VFS超级块读取函数的地址及已注册项的链指针等。</li>
<li>函数<code>register_filesystem()</code>用于注册文件系统类型，函数<code>unregister_filesystem()</code>用于注销一个文件系统类型。</li>
</ul>
</blockquote>
<a id="more"></a>

<h2 id="文件系统的注册"><a href="#文件系统的注册" class="headerlink" title="文件系统的注册"></a><strong>文件系统的注册</strong></h2><p>VFS以链表的形式管理已经注册的文件系统。文件系统的注册有两种途径：</p>
<ul>
<li>第一种是编译操作系统内核的时候确定了可以支持那性文件系统，在文件系统被引导是，在VFS中进行注册。</li>
<li>第二种是文件系统被当作可装载模块，通过insmod/rmmod命令在装入该文件系统模块时向VFS注册。</li>
</ul>
<p><code>文件系统的初始化例程</code>：每个文件系统都有一个初始化例程，它的作用就是在VFS中进行注册，即填写一个叫 file_system_type 的数据结构。</p>
<h3 id="file-system-type数据结构"><a href="#file-system-type数据结构" class="headerlink" title="file_system_type数据结构"></a><strong>file_system_type数据结构</strong></h3><ul>
<li>file_system_type结构包含了文件系统的名称以及一个指向对应的 VFS 超级块读取例程的地址。</li>
<li>所有已注册的文件系统的<strong>file_system_type 结构形成一个链表</strong>，为区别后面将要说到的已安装的文件系统形成的另一个链表，我们把这个链表称为<code>注册链表</code>。</li>
<li>这个注册链表是一个临界资源，受file_systems_lock 自旋读写锁的保护。</li>
</ul>
<p>图1所示就是内核中的 file_system_type 链表，链表头由file_systems变量指定。图1仅示意性地说明系统中已安装的3个文件系统Ext2、proc、iso9660 其file_system_type 结构所形成的链表。</p>
<center><img src="/2020/08/16/Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%B3%A8%E5%86%8C%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/已注册的文件系统形成的链表.PNG">  </center>
<center>图1. 已注册的文件系统形成的链表.PNG</center>



<p>file_system_type数据结构在<a href="https://github.com/torvalds/linux/blob/v3.10/include/linux/fs.h">include/linux/fs.h</a>中定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> &#123;</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *name;     <span class="comment">// 文件系统的类型名，以字符串的形式出现</span></span><br><span class="line">	<span class="keyword">int</span> fs_flags;          <span class="comment">//指明具体文件系统的一些特性。</span></span><br><span class="line">	<span class="comment">/* public flags for file_system_type */</span>  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_REQUIRES_DEV		1 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_BINARY_MOUNTDATA	2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_HAS_SUBTYPE		4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_USERNS_MOUNT		8	<span class="comment">/* Can be mounted by userns root */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_USERNS_DEV_MOUNT	16 <span class="comment">/* A userns mount does not imply MNT_NODEV */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_RENAME_DOES_D_MOVE	32768	<span class="comment">/* FS will handle d_move() during rename() internally. */</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dentry</span> *(*<span class="title">mount</span>) (<span class="title">struct</span> <span class="title">file_system_type</span> *, <span class="title">int</span>,</span></span><br><span class="line"><span class="class">		       <span class="title">const</span> <span class="title">char</span> *, <span class="title">void</span> *);</span></span><br><span class="line">	<span class="keyword">void</span> (*kill_sb) (struct super_block *);  <span class="comment">//删除超级块的方法</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">module</span> *<span class="title">owner</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> * <span class="title">next</span>;</span> <span class="comment">//把所有的file_system_type 结构链接成单项链表的链接指针</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">hlist_head</span> <span class="title">fs_supers</span>;</span>    <span class="comment">//具有相同文件系统类型的超级块对象链表的头</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">s_lock_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">s_umount_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">s_vfs_rename_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">s_writers_key</span>[<span class="title">SB_FREEZE_LEVELS</span>];</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">i_lock_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">i_mutex_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">i_mutex_dir_key</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>fs_flags字段存放几个标志，的说明如下：<ul>
<li>FS_REQUIRES_DEV：这种类型的任何文件系统必须位于物理磁盘设备上</li>
<li>FS_BINARY_MOUNTDATA：文件系统使用的二进制安装数据</li>
<li>一般的文件系统类型要求有物理的设备作为其物质基础，其fs_flags 中的<code>FS_REQUIRES_DEV 标志位</code>为1，这些文件系统如Ext2、Minix、ufs 等。</li>
</ul>
</li>
<li>next：把所有的file_system_type 结构链接成单项链表的链接指针， 变量file_systems 指向这个链表。这个链表是一个临界资源，受<code>file_systems_lock</code> 自旋读写锁的保护。</li>
<li>owner：如果file_system_type 所代表的文件系统是通过可安装模块实现的，则该指针指向代表着具体模块的module 结构。如果文件系统是静态地链接到内核，则这个域为NULL。实际上，你只需要把这个域置为THIS_MODLUE （这是个一个宏），它就能自动地完成上述工作。</li>
<li>fs_supers：一个双向链表。链表中的元素是超级块结构。每个文件系统都有一个超级块，但有些文件系统可能被安装在不同的设备上，而且每个具体的设备都有一个超级块，这些超级块就形成一个双向链表。链表元素的向前和向后链接存放在超级块的s_instances字段中。</li>
<li>kill_sb字段指向删除超级块的函数。</li>
</ul>
<h3 id="register-filesystem-注册函数"><a href="#register-filesystem-注册函数" class="headerlink" title="register_filesystem()注册函数"></a><strong>register_filesystem()注册函数</strong></h3><p>搞清楚这个数据结构的各个域以后， 就很容易理解下面的注册函数register_filesystem()，该函数定义于<a href="https://github.com/torvalds/linux/blob/v3.10/fs/filesystems.c">fs/filesystems.c</a>：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	register_filesystem - register a new filesystem</span></span><br><span class="line"><span class="comment"> *	@fs: the file system structure</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	Adds the file system passed to the list of file systems the kernel</span></span><br><span class="line"><span class="comment"> *	is aware of for mount and other syscalls. Returns 0 on success,</span></span><br><span class="line"><span class="comment"> *	or a negative errno code on an error.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	The &amp;struct file_system_type that is passed is linked into the kernel </span></span><br><span class="line"><span class="comment"> *	structures and must not be freed until the file system has been</span></span><br><span class="line"><span class="comment"> *	unregistered.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">register_filesystem</span><span class="params">(struct file_system_type * fs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> ** <span class="title">p</span>;</span></span><br><span class="line"></span><br><span class="line">	BUG_ON(<span class="built_in">strchr</span>(fs-&gt;name, <span class="string">'.'</span>));</span><br><span class="line">	<span class="keyword">if</span> (fs-&gt;next)</span><br><span class="line">		<span class="keyword">return</span> -EBUSY;</span><br><span class="line">	write_lock(&amp;file_systems_lock);  <span class="comment">//对该链表的查找加了写锁write_lock</span></span><br><span class="line">	p = find_filesystem(fs-&gt;name, <span class="built_in">strlen</span>(fs-&gt;name));</span><br><span class="line">	<span class="keyword">if</span> (*p)</span><br><span class="line">		res = -EBUSY;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		*p = fs;</span><br><span class="line">	write_unlock(&amp;file_systems_lock);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EXPORT_SYMBOL(register_filesystem);</span><br></pre></td></tr></table></figure>
<p>find_filesystem()函数在同一个文件中定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> struct file_system_type **<span class="title">find_filesystem</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">unsigned</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> **<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">for</span> (p=&amp;file_systems; *p; p=&amp;(*p)-&gt;next)</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">strlen</span>((*p)-&gt;name) == len &amp;&amp;</span><br><span class="line">		    <span class="built_in">strncmp</span>((*p)-&gt;name, name, len) == <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="icon has-text-warning"><i class="fas fa-exclamation-triangle"></i></span>注意，对注册链表的操作必须互斥地进行，因此，对该链表的查找加了写锁write_lock。</p>
<h3 id="unregister-filesystem-撤销注册"><a href="#unregister-filesystem-撤销注册" class="headerlink" title="unregister_filesystem()撤销注册"></a><strong>unregister_filesystem()撤销注册</strong></h3><p>文件系统注册后，还可以撤消这个注册，即从注册链表中删除一个<code>file_system_type结构</code>，此后系统不再支持该种文件系统。<br><a href="https://github.com/torvalds/linux/blob/v3.10/fs/filesystems.c">fs/filesystems.c</a>中的unregister_filesystem()函数就是起这个作用的，它在执行成功后返回0，如果注册链表中本来就没有指定的要删除的结构，则返回-1，其代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	unregister_filesystem - unregister a file system</span></span><br><span class="line"><span class="comment"> *	@fs: filesystem to unregister</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	Remove a file system that was previously successfully registered</span></span><br><span class="line"><span class="comment"> *	with the kernel. An error is returned if the file system is not found.</span></span><br><span class="line"><span class="comment"> *	Zero is returned on a success.</span></span><br><span class="line"><span class="comment"> *	</span></span><br><span class="line"><span class="comment"> *	Once this function has returned the &amp;struct file_system_type structure</span></span><br><span class="line"><span class="comment"> *	may be freed or reused.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">unregister_filesystem</span><span class="params">(struct file_system_type * fs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> ** <span class="title">tmp</span>;</span></span><br><span class="line"></span><br><span class="line">	write_lock(&amp;file_systems_lock);</span><br><span class="line">	tmp = &amp;file_systems;</span><br><span class="line">	<span class="keyword">while</span> (*tmp) &#123;</span><br><span class="line">		<span class="keyword">if</span> (fs == *tmp) &#123;</span><br><span class="line">			*tmp = fs-&gt;next;</span><br><span class="line">			fs-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">			write_unlock(&amp;file_systems_lock);</span><br><span class="line">			synchronize_rcu();</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		tmp = &amp;(*tmp)-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	write_unlock(&amp;file_systems_lock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> -EINVAL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EXPORT_SYMBOL(unregister_filesystem);</span><br></pre></td></tr></table></figure>

<h2 id="文件系统的安装"><a href="#文件系统的安装" class="headerlink" title="文件系统的安装"></a><strong>文件系统的安装</strong></h2><blockquote>
<p>安装一个文件系统时，内核首先要检查参数的合法性，VFS通过查找由file_systems（file_system_type的首结点）指向的注册表，寻找匹配的file_system_type，就可获得读取文件系统超级块函数的地址，接着查找作为新文件系统安装点的VFS inode,VFS安装程序必须分配一个VFS超级块，然后读入安装文件系统的超级块，并进行填充，再申请一个vfsmount数据结构（其中包含了文件系统所在的块设备的标识、安装点及指向VFS超级块的指针等），使它的指针指向所分配的VFS超级块。当文件系统安装以后，它的根inode便常驻在inode高速缓存中。<br>总的来说，安装过程的主要工作是：创建安装点对象、将其挂接到根文件系统的指定安装点下、初始化超级块对象从而获得文件系统的基本信息和相关的操作。</p>
</blockquote>
<p>要使用一个文件系统，仅仅注册是不行的，还必须安装这个文件系统。</p>
<ul>
<li>Linux使用系统的<code>根文件系统(system&#39;s root filesystem)</code>，它由内核在引导阶段直接安装，并拥有系统初始化脚本以及最基本的系统程序。在安装Linux 时，硬盘上已经有一个分区安装了ext3文件系统（也可能是其他种类的系统），它是作为根文件系统的，根文件系统在启动时自动安装。其实，在系统启动后你所看到的文件系统，都是在启动时安装的。</li>
<li>其他文件系统要么由初始化脚本安装，要么由用户直接安装在已安装文件系统的目录上。</li>
</ul>
<p>作为一个目录树，每个文件系统都拥有自己的根目录(root directory)。安装文件系统的这个目录称之为<code>安装点(mount point)</code>。已安装文件系统属于安装点目录的一个子文件系统。</p>
<ul>
<li>例如，/proc虚拟文件系统是系统的根文件系统的孩子(且系统的根文件系统是/proc的父亲)。</li>
<li>已安装文件系统的根目录隐藏了父文件系统的安装点目录原来的内容，而且父文件系统的整个子树位于安装点之下。</li>
</ul>
<h3 id="mount命令"><a href="#mount命令" class="headerlink" title="mount命令"></a><strong>mount命令</strong></h3><p>如果需要自己（一般是超级用户）<strong>安装文件系统</strong>，则需要指定3 种信息：文件系统的<strong>名称</strong>、包含文件系统的<strong>物理块设备</strong>、文件系统在已有文件系统中的<strong>安装点</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext3 /dev/sda5 /mnt</span><br></pre></td></tr></table></figure>
<ul>
<li>ext3 就是文件系统的名称</li>
<li>/dev/sda5 是包含文件系统的物理块设备，</li>
<li>/mnt 是将要安装到的目录，即安装点。</li>
<li>从这个例子可以看出，安装一个文件系统实际上是安装一个物理设备。</li>
</ul>
<h3 id="vfsmount数据结构"><a href="#vfsmount数据结构" class="headerlink" title="vfsmount数据结构"></a><strong>vfsmount数据结构</strong></h3><p>把一个文件系统（或设备）安装到一个目录点时要用到的主要数据结构为<code>vfsmount</code>和<code>struct mount</code>，定义于<a href="https://github.com/torvalds/linux/blob/v3.10/include/linux/mount.h">include/linux/mount.h</a> 中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">vfsmount</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dentry</span> *<span class="title">mnt_root</span>;</span>	<span class="comment">/* root of the mounted tree */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">super_block</span> *<span class="title">mnt_sb</span>;</span>	<span class="comment">/* pointer to superblock */</span></span><br><span class="line">	<span class="keyword">int</span> mnt_flags;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>mnt_sb 指向所安装设备的超级块结构super_block。</li>
</ul>
<p>文件系统的安装选项，也就是vfsmount 结构中的安装标志mnt_flags在<a href="https://github.com/torvalds/linux/blob/v3.10/include/uapi/linux/fs.h#L62">include/uapi/linux/fs.h</a> 中，定义如下：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * These are the fs-independent mount-flags: up to 32 flags are supported</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_RDONLY	 1	<span class="comment">/* Mount read-only */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOSUID	 2	<span class="comment">/* Ignore suid and sgid bits */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NODEV	 4	<span class="comment">/* Disallow access to device special files */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOEXEC	 8	<span class="comment">/* Disallow program execution */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_SYNCHRONOUS	16	<span class="comment">/* Writes are synced at once */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_REMOUNT	32	<span class="comment">/* Alter flags of a mounted FS */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_MANDLOCK	64	<span class="comment">/* Allow mandatory locks on an FS */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_DIRSYNC	128	<span class="comment">/* Directory modifications are synchronous */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOATIME	1024	<span class="comment">/* Do not update access times. */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NODIRATIME	2048	<span class="comment">/* Do not update directory access times */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_BIND		4096</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_MOVE		8192</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_REC		16384</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_VERBOSE	32768	<span class="comment">/* War is peace. Verbosity is silence.</span></span></span><br><span class="line"><span class="meta"><span class="comment">				   MS_VERBOSE is deprecated. */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_SILENT	32768</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_POSIXACL	(1&lt;&lt;16)	<span class="comment">/* VFS does not apply the umask */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_UNBINDABLE	(1&lt;&lt;17)	<span class="comment">/* change to unbindable */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_PRIVATE	(1&lt;&lt;18)	<span class="comment">/* change to private */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_SLAVE	(1&lt;&lt;19)	<span class="comment">/* change to slave */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_SHARED	(1&lt;&lt;20)	<span class="comment">/* change to shared */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_RELATIME	(1&lt;&lt;21)	<span class="comment">/* Update atime relative to mtime/ctime. */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_KERNMOUNT	(1&lt;&lt;22) <span class="comment">/* this is a kern_mount call */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_I_VERSION	(1&lt;&lt;23) <span class="comment">/* Update inode I_version field */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_STRICTATIME	(1&lt;&lt;24) <span class="comment">/* Always perform atime updates */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* These sb flags are internal to the kernel */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOSEC	(1&lt;&lt;28)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_BORN		(1&lt;&lt;29)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_ACTIVE	(1&lt;&lt;30)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOUSER	(1&lt;&lt;31)</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li><strong>从定义可以看出，每个标志对应32 位中的一位。</strong></li>
<li>安装标志是针对整个文件系统中的所有文件的。例如，如果MS_NOSUID 标志为1，则整个文件系统中所有可执行文件的suid 标志位都不起作用了。</li>
</ul>
<h3 id="struct-mount结构"><a href="#struct-mount结构" class="headerlink" title="struct mount结构"></a><strong>struct mount结构</strong></h3><p>struct mount结构在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/mount.h#L27">linux/fs/mount.h</a>：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mount</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_hash</span>;</span>    <span class="comment">//安装点的哈希表</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mount</span> *<span class="title">mnt_parent</span>;</span>     <span class="comment">//是指向上一层安装点的指针</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dentry</span> *<span class="title">mnt_mountpoint</span>;</span> <span class="comment">//指向安装点dentry 结构的指针</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">vfsmount</span> <span class="title">mnt</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mnt_pcp</span> __<span class="title">percpu</span> *<span class="title">mnt_pcp</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	<span class="keyword">int</span> mnt_count;</span><br><span class="line">	<span class="keyword">int</span> mnt_writers;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_mounts</span>;</span>	<span class="comment">/* list of children, anchored here */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_child</span>;</span>	<span class="comment">/* and going through their mnt_child */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_instance</span>;</span>	<span class="comment">/* mount instance on sb-&gt;s_mounts */</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *mnt_devname;	<span class="comment">/* Name of device e.g. /dev/dsk/hda1 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_list</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_expire</span>;</span>	<span class="comment">/* link in fs-specific expiry list */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_share</span>;</span>	<span class="comment">/* circular list of shared mounts */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_slave_list</span>;</span><span class="comment">/* list of slave mounts */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_slave</span>;</span>	<span class="comment">/* slave list entry */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mount</span> *<span class="title">mnt_master</span>;</span>	<span class="comment">/* slave is on master-&gt;mnt_slave_list */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mnt_namespace</span> *<span class="title">mnt_ns</span>;</span>	<span class="comment">/* containing namespace */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mountpoint</span> *<span class="title">mnt_mp</span>;</span>	<span class="comment">/* where is it mounted */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FSNOTIFY</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">hlist_head</span> <span class="title">mnt_fsnotify_marks</span>;</span></span><br><span class="line">	__u32 mnt_fsnotify_mask;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">int</span> mnt_id;			<span class="comment">/* mount identifier */</span></span><br><span class="line">	<span class="keyword">int</span> mnt_group_id;		<span class="comment">/* peer group identifier */</span></span><br><span class="line">	<span class="keyword">int</span> mnt_expiry_mark;		<span class="comment">/* true if marked for expiry */</span></span><br><span class="line">	<span class="keyword">int</span> mnt_pinned;</span><br><span class="line">	<span class="keyword">int</span> mnt_ghosts;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>mnt_hash：为了对系统中的所有安装点进行快速查找，内核把它们按哈希表来组织，mnt_hash就是形成哈希表的队列指针。</li>
<li>mnt_mountpoint： 是指向安装点dentry 结构的指针。而dentry 指针指向安装点所在目录树中根目录的dentry 结构。？</li>
<li>mnt_parent： 是指向上一层安装点的指针。如果当前的安装点没有上一层安装点（如根设备），则这个指针为NULL。</li>
<li>同时，vfsmount 结构中还有mnt_mounts 和mnt_child 两个队列头<ul>
<li>只要上一层vfsmount 结构存在，就把当前vfsmount 结构中mnt_child 链入上一层vfsmount 结构的mnt_mounts 队列中。这样就形成一个<strong>设备安装的树结构</strong>，从一个vfsmount结构的mnt_mounts 队列开始，可以找到所有直接或间接安装在这个安装点上的其他设备。</li>
</ul>
</li>
<li>mnt_list：是指向vfsmount结构所形成链表的头指针。</li>
</ul>
<p>另外，系统还定义了vfsmntlist 变量，指向mnt_list 队列。//在Linux kernel3.10 中没有vfsmntlist</p>
<h3 id="安装根文件系统"><a href="#安装根文件系统" class="headerlink" title="安装根文件系统"></a><strong>安装根文件系统</strong></h3><blockquote>
<p>每个文件系统都有它自己的根目录，如果某个文件系统（如Ext3）的根目录是系统目录树的根目录，那么该文件系统称为<code>根文件系统</code>。而其他文件系统可以安装在系统的目录树上，把这些文件系统要插入的那些目录就称为<code>安装点</code>。</p>
</blockquote>
<ul>
<li>当系统启动时，就要在<code>变量ROOT_DEV</code> 中寻找包含根文件系统的磁盘主码。</li>
<li>当编译内核或向最初的启动装入程序传递一个合适的选项时，根文件系统可以被指定为/dev 目录下的一个设备文件。</li>
<li>类似地，根文件系统的安装标志存放在<code>root_mountflags 变量</code>中。用户可以指定这些标志，这是通过对已编译的内核映像执行/sbin/rdev 外部程序，或者向最初的启动装入程序传递一个合适的选项来达到的。</li>
<li>根文件系统的安装函数为<code>mount_root()</code>。</li>
</ul>
<h3 id="安装一个常规文件系统"><a href="#安装一个常规文件系统" class="headerlink" title="安装一个常规文件系统"></a><strong>安装一个常规文件系统</strong></h3><p>一旦在系统中安装了根文件系统，就可以安装其他的文件系统。每个文件系统都可以安装在系统目录树中的一个目录上。</p>
<p>安装文件系统的两个系统的两种方式：</p>
<ul>
<li>以命令方式来安装文件系统，例如mount命令。</li>
<li>在用户程序中要安装一个文件系统则可以调用mount()系统调用。</li>
</ul>
<h3 id="sys-mount-函数"><a href="#sys-mount-函数" class="headerlink" title="sys_mount()函数"></a>sys_mount()函数</h3><p>mount()系统调用在内核的实现函数为<code>sys_mount()</code>，其函数定义使用SYSCALL_DEFINE定义，其代码在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L2503">fs/namespace.c</a> 中。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*sys_mount系统调用*/</span></span><br><span class="line"><span class="comment">/*	dev_name为待安装设备的路径名；</span></span><br><span class="line"><span class="comment">	dir_name为安装点的路径名；</span></span><br><span class="line"><span class="comment">	type是表示文件系统类型的字符串；</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">SYSCALL_DEFINE5(mount, <span class="keyword">char</span> __user *, dev_name, <span class="keyword">char</span> __user *, dir_name,</span><br><span class="line">		<span class="keyword">char</span> __user *, type, <span class="keyword">unsigned</span> <span class="keyword">long</span>, flags, <span class="keyword">void</span> __user *, data)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line">	<span class="keyword">char</span> *kernel_type;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">filename</span> *<span class="title">kernel_dir</span>;</span></span><br><span class="line">	<span class="keyword">char</span> *kernel_dev;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> data_page;</span><br><span class="line"></span><br><span class="line">	ret = copy_mount_string(type, &amp;kernel_type);</span><br><span class="line">	<span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> out_type;</span><br><span class="line"></span><br><span class="line">	kernel_dir = getname(dir_name);</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(kernel_dir)) &#123;</span><br><span class="line">		ret = PTR_ERR(kernel_dir);</span><br><span class="line">		<span class="keyword">goto</span> out_dir;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ret = copy_mount_string(dev_name, &amp;kernel_dev);</span><br><span class="line">	<span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> out_dev;</span><br><span class="line"></span><br><span class="line">	ret = copy_mount_options(data, &amp;data_page);</span><br><span class="line">	<span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> out_data;</span><br><span class="line"></span><br><span class="line">	ret = do_mount(kernel_dev, kernel_dir-&gt;name, kernel_type, flags,</span><br><span class="line">		(<span class="keyword">void</span> *) data_page);</span><br><span class="line"></span><br><span class="line">	free_page(data_page);</span><br><span class="line">out_data:</span><br><span class="line">	kfree(kernel_dev);</span><br><span class="line">out_dev:</span><br><span class="line">	putname(kernel_dir);</span><br><span class="line">out_dir:</span><br><span class="line">	kfree(kernel_type);</span><br><span class="line">out_type:</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>dev_name为待安装文件系统所在设备的路径名，如果不需要就为空（例如，当待安装的是基于网络的文件系统时）；</li>
<li>dir_name 则是安装点（空闲目录）的路径名；</li>
<li>type 是文件系统的类型，必须是已注册文件系统的字符串名（如“Ext3”）</li>
<li>flags是安装模式，如前面所述。</li>
<li>data 指向一个与文件系统相关的数据结构（可以为NULL）。</li>
<li>copy_mount_options()和getname()函数将结构形式或字符串形式的参数值从用户空间拷贝到内核空间。<ul>
<li>这些参数值的长度均以一个页面为限，但是getname()在复制时遇到字符串结尾符“\0”就停止，并返回指向该字符串的指针；</li>
<li>而copy_mount_options()则拷贝整个页面，并返回该页面的起始地址。</li>
</ul>
</li>
<li>该函数调用的主要函数为do_mount()，do_mount()执行期间要加内核锁，不过这个锁是针对SMP，我们暂不考虑。</li>
</ul>
<p><code>do_mount()</code>的实现代码在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L2247">fs/namespace.c</a>中：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Flags is a 32-bit value that allows up to 31 non-fs dependent flags to</span></span><br><span class="line"><span class="comment"> * be given to the mount() call (ie: read-only, no-dev, no-suid etc).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * data is a (void *) that can point to any structure up to</span></span><br><span class="line"><span class="comment"> * PAGE_SIZE-1 bytes, which can contain arbitrary fs-dependent</span></span><br><span class="line"><span class="comment"> * information (or be NULL).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Pre-0.97 versions of mount() didn't have a flags word.</span></span><br><span class="line"><span class="comment"> * When the flags word was introduced its top half was required</span></span><br><span class="line"><span class="comment"> * to have the magic value 0xC0ED, and this remained so until 2.4.0-test9.</span></span><br><span class="line"><span class="comment"> * Therefore, if this magic number is present, it carries no information</span></span><br><span class="line"><span class="comment"> * and must be discarded.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">do_mount</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *dev_name, <span class="keyword">const</span> <span class="keyword">char</span> *dir_name,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">const</span> <span class="keyword">char</span> *type_page, <span class="keyword">unsigned</span> <span class="keyword">long</span> flags, <span class="keyword">void</span> *data_page)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">path</span> <span class="title">path</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> mnt_flags = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Discard magic */</span></span><br><span class="line">	<span class="keyword">if</span> ((flags &amp; MS_MGC_MSK) == MS_MGC_VAL)</span><br><span class="line">		flags &amp;= ~MS_MGC_MSK;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Basic sanity checks */</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!dir_name || !*dir_name || !<span class="built_in">memchr</span>(dir_name, <span class="number">0</span>, PAGE_SIZE))</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (data_page)</span><br><span class="line">		((<span class="keyword">char</span> *)data_page)[PAGE_SIZE - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* ... and get the mountpoint */</span></span><br><span class="line">	retval = kern_path(dir_name, LOOKUP_FOLLOW, &amp;path);</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">return</span> retval;</span><br><span class="line"></span><br><span class="line">	retval = security_sb_mount(dev_name, &amp;path,</span><br><span class="line">				   type_page, flags, data_page);</span><br><span class="line">	<span class="keyword">if</span> (!retval &amp;&amp; !may_mount())</span><br><span class="line">		retval = -EPERM;</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">goto</span> dput_out;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Default to relatime unless overriden */</span></span><br><span class="line">	<span class="keyword">if</span> (!(flags &amp; MS_NOATIME))</span><br><span class="line">		mnt_flags |= MNT_RELATIME;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Separate the per-mountpoint flags */</span></span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NOSUID)</span><br><span class="line">		mnt_flags |= MNT_NOSUID;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NODEV)</span><br><span class="line">		mnt_flags |= MNT_NODEV;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NOEXEC)</span><br><span class="line">		mnt_flags |= MNT_NOEXEC;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NOATIME)</span><br><span class="line">		mnt_flags |= MNT_NOATIME;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NODIRATIME)</span><br><span class="line">		mnt_flags |= MNT_NODIRATIME;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_STRICTATIME)</span><br><span class="line">		mnt_flags &amp;= ~(MNT_RELATIME | MNT_NOATIME);</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_RDONLY)</span><br><span class="line">		mnt_flags |= MNT_READONLY;</span><br><span class="line"></span><br><span class="line">	flags &amp;= ~(MS_NOSUID | MS_NOEXEC | MS_NODEV | MS_ACTIVE | MS_BORN |</span><br><span class="line">		   MS_NOATIME | MS_NODIRATIME | MS_RELATIME| MS_KERNMOUNT |</span><br><span class="line">		   MS_STRICTATIME);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_REMOUNT)</span><br><span class="line">		retval = do_remount(&amp;path, flags &amp; ~MS_REMOUNT, mnt_flags,</span><br><span class="line">				    data_page);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (flags &amp; MS_BIND)</span><br><span class="line">		retval = do_loopback(&amp;path, dev_name, flags &amp; MS_REC);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (flags &amp; (MS_SHARED | MS_PRIVATE | MS_SLAVE | MS_UNBINDABLE))</span><br><span class="line">		retval = do_change_type(&amp;path, flags);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (flags &amp; MS_MOVE)</span><br><span class="line">		retval = do_move_mount(&amp;path, dev_name);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		retval = do_new_mount(&amp;path, type_page, flags, mnt_flags,</span><br><span class="line">				      dev_name, data_page);</span><br><span class="line">dput_out:</span><br><span class="line">	path_put(&amp;path);</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对函数中的主要代码给予说明:</p>
<ul>
<li>对参数dir_name 和dev_name 进行基本检查，注意“！dir_name ” 和“!*dir_name”的不同，前者指指向字符串的指针为不为空，而后者指字符串不为空。memchr()函数在指定长度的字符串中寻找指定的字符，如果字符串中没有结尾符“\0”，也是一种错误。前面已说过，对于基于网络的文件系统dev_name 可以为空。</li>
<li>把安装标志为MS_NOSUID、MS_NOEXEC 和MS_NODEV 的3个标志位从flags 分离出来，放在局部安装标志变量mnt_flags 中。</li>
<li>如果flags 中的MS_REMOUNT 标志位为1，就表示所要求的只是改变一个原已安装设备的安装方式，例如从“只读“安装方式改为“可写”安装方式，这是通过调用<code>do_remount()</code>函数完成的。</li>
<li>如果flags 中的MS_BIND 标志位为1，就表示把一个“回接”设备捆绑到另一个对象上。<ul>
<li>回接设备是一种特殊的设备（虚拟设备），而实际上并不是一种真正设备，而是一种机制，这种机制提供了把回接设备回接到某个可访问的常规文件或块设备的手段。通常在/dev目录中有/dev/loop0 和/dev/loop1 两个回接设备文件。调用<code>do_loopback()</code>来实现回接设备的安装。</li>
</ul>
</li>
<li>如果flags 中的MS_MOVE 标志位为1，就表示把一个已安装的设备可以移到另一个安装点，这是通过调用<code>do_move_mount()</code>函数来实现的。</li>
<li>如果不是以上3 种情况，那就是一般的安装请求，于是把安装点加入到目录树中，这是通过调用<code>do_new_mount()函数</code>来实现的，而do_new_mount()首先调用<code>vfs_kern_mount函数</code>形成一个安装点。do_new_mount()函数也调用了</li>
</ul>
<p><code>do_new_mount()函数</code>的代码在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L1969">fs/namespace.c</a> 中：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * create a new mount for userspace and request it to be added into the</span></span><br><span class="line"><span class="comment"> * namespace's tree</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">do_new_mount</span><span class="params">(struct path *path, <span class="keyword">const</span> <span class="keyword">char</span> *fstype, <span class="keyword">int</span> flags,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">int</span> mnt_flags, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">void</span> *data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> *<span class="title">type</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">user_namespace</span> *<span class="title">user_ns</span> = <span class="title">current</span>-&gt;<span class="title">nsproxy</span>-&gt;<span class="title">mnt_ns</span>-&gt;<span class="title">user_ns</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">vfsmount</span> *<span class="title">mnt</span>;</span></span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!fstype)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	type = get_fs_type(fstype);</span><br><span class="line">	<span class="keyword">if</span> (!type)</span><br><span class="line">		<span class="keyword">return</span> -ENODEV;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (user_ns != &amp;init_user_ns) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!(type-&gt;fs_flags &amp; FS_USERNS_MOUNT)) &#123;</span><br><span class="line">			put_filesystem(type);</span><br><span class="line">			<span class="keyword">return</span> -EPERM;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/* Only in special cases allow devices from mounts</span></span><br><span class="line"><span class="comment">		 * created outside the initial user namespace.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (!(type-&gt;fs_flags &amp; FS_USERNS_DEV_MOUNT)) &#123;</span><br><span class="line">			flags |= MS_NODEV;</span><br><span class="line">			mnt_flags |= MNT_NODEV;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	mnt = vfs_kern_mount(type, flags, name, data);</span><br><span class="line">	<span class="keyword">if</span> (!IS_ERR(mnt) &amp;&amp; (type-&gt;fs_flags &amp; FS_HAS_SUBTYPE) &amp;&amp;</span><br><span class="line">	    !mnt-&gt;mnt_sb-&gt;s_subtype)</span><br><span class="line">		mnt = fs_set_subtype(mnt, fstype);</span><br><span class="line"></span><br><span class="line">	put_filesystem(type);</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(mnt))</span><br><span class="line">		<span class="keyword">return</span> PTR_ERR(mnt);</span><br><span class="line"></span><br><span class="line">	err = do_add_mount(real_mount(mnt), path, mnt_flags);</span><br><span class="line">	<span class="keyword">if</span> (err)</span><br><span class="line">		mntput(mnt);</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对函数中的主要代码给予说明:</p>
<ul>
<li>只有系统管理员才具有安装一个设备的权力，因此首先要检查当前进程是否具有这种权限。</li>
<li>get_fs_type()函数根据具体文件系统的类型名在file_system_file 链表中找到相应的结构。</li>
</ul>
<p><code>vfs_kern_mount()函数</code>代码在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L774">fs/namespace.c</a> 中：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">vfsmount</span> *</span></span><br><span class="line"><span class="class"><span class="title">vfs_kern_mount</span>(<span class="title">struct</span> <span class="title">file_system_type</span> *<span class="title">type</span>, <span class="title">int</span> <span class="title">flags</span>, <span class="title">const</span> <span class="title">char</span> *<span class="title">name</span>, <span class="title">void</span> *<span class="title">data</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mount</span> *<span class="title">mnt</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dentry</span> *<span class="title">root</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!type)</span><br><span class="line">		<span class="keyword">return</span> ERR_PTR(-ENODEV);</span><br><span class="line"></span><br><span class="line">	mnt = alloc_vfsmnt(name);</span><br><span class="line">	<span class="keyword">if</span> (!mnt)</span><br><span class="line">		<span class="keyword">return</span> ERR_PTR(-ENOMEM);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_KERNMOUNT)</span><br><span class="line">		mnt-&gt;mnt.mnt_flags = MNT_INTERNAL;</span><br><span class="line"></span><br><span class="line">	root = mount_fs(type, flags, name, data);</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(root)) &#123;</span><br><span class="line">		free_vfsmnt(mnt);</span><br><span class="line">		<span class="keyword">return</span> ERR_CAST(root);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	mnt-&gt;mnt.mnt_root = root;</span><br><span class="line">	mnt-&gt;mnt.mnt_sb = root-&gt;d_sb;</span><br><span class="line">	mnt-&gt;mnt_mountpoint = mnt-&gt;mnt.mnt_root;</span><br><span class="line">	mnt-&gt;mnt_parent = mnt;</span><br><span class="line">	br_write_lock(&amp;vfsmount_lock);</span><br><span class="line">	list_add_tail(&amp;mnt-&gt;mnt_instance, &amp;root-&gt;d_sb-&gt;s_mounts);</span><br><span class="line">	br_write_unlock(&amp;vfsmount_lock);</span><br><span class="line">	<span class="keyword">return</span> &amp;mnt-&gt;mnt;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(vfs_kern_mount);</span><br></pre></td></tr></table></figure>
<ul>
<li>alloc_vfsmnt（）函数调用slab 分配器给类型为vfsmount 结构的局部变量mnt 分配空间，并进行相应的初始化。</li>
</ul>
<p><code>do_add_mount()函数</code>代码，<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L1924">fs/namespace.c</a> 中：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * add a mount into a namespace's mount tree</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">do_add_mount</span><span class="params">(struct mount *newmnt, struct path *path, <span class="keyword">int</span> mnt_flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mountpoint</span> *<span class="title">mp</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mount</span> *<span class="title">parent</span>;</span></span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	mnt_flags &amp;= ~(MNT_SHARED | MNT_WRITE_HOLD | MNT_INTERNAL);</span><br><span class="line"></span><br><span class="line">	mp = lock_mount(path);</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(mp))</span><br><span class="line">		<span class="keyword">return</span> PTR_ERR(mp);</span><br><span class="line"></span><br><span class="line">	parent = real_mount(path-&gt;mnt);</span><br><span class="line">	err = -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> (unlikely(!check_mnt(parent))) &#123;</span><br><span class="line">		<span class="comment">/* that's acceptable only for automounts done in private ns */</span></span><br><span class="line">		<span class="keyword">if</span> (!(mnt_flags &amp; MNT_SHRINKABLE))</span><br><span class="line">			<span class="keyword">goto</span> unlock;</span><br><span class="line">		<span class="comment">/* ... and for those we'd better have mountpoint still alive */</span></span><br><span class="line">		<span class="keyword">if</span> (!parent-&gt;mnt_ns)</span><br><span class="line">			<span class="keyword">goto</span> unlock;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Refuse the same filesystem on the same mount point */</span></span><br><span class="line">	err = -EBUSY;</span><br><span class="line">	<span class="keyword">if</span> (path-&gt;mnt-&gt;mnt_sb == newmnt-&gt;mnt.mnt_sb &amp;&amp;</span><br><span class="line">	    path-&gt;mnt-&gt;mnt_root == path-&gt;dentry)</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	err = -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> (S_ISLNK(newmnt-&gt;mnt.mnt_root-&gt;d_inode-&gt;i_mode))</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	newmnt-&gt;mnt.mnt_flags = mnt_flags;</span><br><span class="line">	err = graft_tree(newmnt, parent, mp);</span><br><span class="line"></span><br><span class="line">unlock:</span><br><span class="line">	unlock_mount(mp);</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文件系统的卸载"><a href="#文件系统的卸载" class="headerlink" title="文件系统的卸载"></a><strong>文件系统的卸载</strong></h2><p>如果文件系统中的文件当前正在使用，该文件系统是不能被卸载的。<br>如果文件系统中的文件或目录正在使用，则 VFS 索引节点高速缓存中可能包含相应的 VFS 索引节点。<br>根据文件系统所在设备的标识符，检查在索引节点高速缓存中是否有来自该文件系统的 VFS 索引节点，如果有且使用计数大于0，则说明该文件系统正在被使用，因此，该文件系统不能被卸<br>载。否则，查看对应的 VFS 超级块，如果该文件系统的 VFS 超级块标志为“脏”，则必须将超级块信息写回磁盘。<br>上述过程结束之后，对应的 VFS 超级块被释放，vfsmount 数据结构将从vfsmntlist链表中断开并被释放。<br>具体的实现代码为fs/super.c 中的sys_umount()函数。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a><strong>参考资料</strong></h2><p>《深入分析Linux内核源代码》 //书籍内核版本有些旧<br><a href="https://www.ibm.com/developerworks/cn/linux/l-lpic1-v3-104-3/index.html">控制文件系统的安装和卸载</a><br><a href="http://tjpm.blog.chinaunix.net/uid-27007072-id-3336479.html">文件系统的注册与注销、安装与卸载</a><br><a href="https://zhuanlan.zhihu.com/p/36240056">文件系统怎么让Linux内核认识自己</a><br><a href="https://zhuanlan.zhihu.com/p/36268333">mount系统调用初探</a></p>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a><strong>注解</strong></h2><p>uapi文件夹：（the user space API of the kernel，Then upon kernel installation, the uapi include files become the top level /usr/include/linux/ files.）Linux Kernel 中新增的这些 uapi 头文件，其实都是来自于各个模块原先的头文件，最先是由 David Howells 提出来的。uapi 只是把内核用到的头文件和用户态用到的头文件分开。<br>Linux的系统调用都改为SYSCALL_DEFINE定义,原因参照：<a href="https://blog.csdn.net/hxmhyp/article/details/22699669">Linux系统调用之SYSCALL_DEFINE</a>。</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/Linux/" rel="tag">Linux</a>, <a class="has-link-grey -link" href="/tags/%E5%86%85%E6%A0%B8/" rel="tag">内核</a>, <a class="has-link-grey -link" href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" rel="tag">文件系统</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2020/08/17/Linux-%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Linux-块设备驱动程序</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2020/08/12/Linux-VFS%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
                <span class="level-item">Linux-VFS中的数据结构</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">评论</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.min.js"></script>
<script>
    var gitalk = new Gitalk({
        clientID: 'e79770cfee30db02a856',
        clientSecret: 'bb958f5fc30797ffc222ca631ec345baa48a0bee',
        id: '7a711ed606220788332c6364228afcf0',
        repo: 'STEMHA.github.io',
        owner: 'STEMHA',
        admin: "STEMHA",
        createIssueManually: false,
        distractionFreeMode: false
    })
    gitalk.render('comment-container')
</script>

    </div>
</div>
</div>-->
			   <!-- 原始代码-->
               <!--  




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="STEMHA">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        STEMHA
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        student
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            71
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            14
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            103
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/STEMHA" target="_blank" rel="noopener">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/STEMHA">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/rss.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        

    <div class="card widget" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    目录
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#概述">
        <span class="has-mr-6">1</span>
        <span>概述</span>
        </a></li><li>
        <a class="is-flex" href="#文件系统的注册">
        <span class="has-mr-6">2</span>
        <span>文件系统的注册</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#file-system-type数据结构">
        <span class="has-mr-6">2.1</span>
        <span>file_system_type数据结构</span>
        </a></li><li>
        <a class="is-flex" href="#register-filesystem-注册函数">
        <span class="has-mr-6">2.2</span>
        <span>register_filesystem()注册函数</span>
        </a></li><li>
        <a class="is-flex" href="#unregister-filesystem-撤销注册">
        <span class="has-mr-6">2.3</span>
        <span>unregister_filesystem()撤销注册</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#文件系统的安装">
        <span class="has-mr-6">3</span>
        <span>文件系统的安装</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#mount命令">
        <span class="has-mr-6">3.1</span>
        <span>mount命令</span>
        </a></li><li>
        <a class="is-flex" href="#vfsmount数据结构">
        <span class="has-mr-6">3.2</span>
        <span>vfsmount数据结构</span>
        </a></li><li>
        <a class="is-flex" href="#struct-mount结构">
        <span class="has-mr-6">3.3</span>
        <span>struct mount结构</span>
        </a></li><li>
        <a class="is-flex" href="#安装根文件系统">
        <span class="has-mr-6">3.4</span>
        <span>安装根文件系统</span>
        </a></li><li>
        <a class="is-flex" href="#安装一个常规文件系统">
        <span class="has-mr-6">3.5</span>
        <span>安装一个常规文件系统</span>
        </a></li><li>
        <a class="is-flex" href="#sys-mount-函数">
        <span class="has-mr-6">3.6</span>
        <span>sys_mount()函数</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#文件系统的卸载">
        <span class="has-mr-6">4</span>
        <span>文件系统的卸载</span>
        </a></li><li>
        <a class="is-flex" href="#参考资料">
        <span class="has-mr-6">5</span>
        <span>参考资料</span>
        </a></li><li>
        <a class="is-flex" href="#注解">
        <span class="has-mr-6">6</span>
        <span>注解</span>
        </a></li></ul>
            </div>
        </div>
    </div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/ppoffice" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/STEMHA" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">GitHub - STEMHA</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/C/">
            <span class="level-start">
                <span class="level-item">C++</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">18</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Linux/">
            <span class="level-start">
                <span class="level-item">Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">20</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E5%8D%9A%E5%AE%A2%E7%BB%B4%E6%8A%A4/">
            <span class="level-start">
                <span class="level-item">博客维护</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E5%AD%A6%E6%9C%AF%E8%AE%BA%E6%96%87/">
            <span class="level-start">
                <span class="level-item">学术论文</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
            <span class="level-start">
                <span class="level-item">操作系统</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/">
            <span class="level-start">
                <span class="level-item">效率工具</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
            <span class="level-start">
                <span class="level-item">数据结构</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E7%AE%97%E6%B3%95/">
            <span class="level-start">
                <span class="level-item">算法</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/">
            <span class="level-start">
                <span class="level-item">英语学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
            <span class="level-start">
                <span class="level-item">计算机网络</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">
            <span class="level-start">
                <span class="level-item">读书笔记</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%AF%BE%E5%A4%96%E5%AD%A6%E6%9C%AF%E9%98%85%E8%AF%BB/">
            <span class="level-start">
                <span class="level-item">课外学术阅读</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">
            <span class="level-start">
                <span class="level-item">软件工程</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E9%86%92%E4%B8%96%E9%80%9A%E8%A8%80/">
            <span class="level-start">
                <span class="level-item">醒世通言</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/B-%E6%A0%91/" style="font-size: 10px;">B+树</a> <a href="/tags/B-%E6%A0%91/" style="font-size: 10px;">B-树</a> <a href="/tags/C/" style="font-size: 16.25px;">C++</a> <a href="/tags/C-%E6%A0%87%E5%87%86%E5%BA%93/" style="font-size: 18.75px;">C++标准库</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Linux%E6%A6%82%E8%BF%B0/" style="font-size: 10px;">Linux概述</a> <a href="/tags/TCP/" style="font-size: 13.75px;">TCP</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/VFS/" style="font-size: 10px;">VFS</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/deque/" style="font-size: 10px;">deque</a> <a href="/tags/heap/" style="font-size: 10px;">heap</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/leetcode/" style="font-size: 10px;">leetcode</a> <a href="/tags/list/" style="font-size: 10px;">list</a> <a href="/tags/map/" style="font-size: 10px;">map</a> <a href="/tags/module/" style="font-size: 10px;">module</a> <a href="/tags/pair/" style="font-size: 10px;">pair</a> <a href="/tags/priority-queue/" style="font-size: 10px;">priority_queue</a> <a href="/tags/queue/" style="font-size: 10px;">queue</a> <a href="/tags/set/" style="font-size: 10px;">set</a> <a href="/tags/stack/" style="font-size: 10px;">stack</a> <a href="/tags/string/" style="font-size: 10px;">string</a> <a href="/tags/vector/" style="font-size: 10px;">vector</a> <a href="/tags/%E4%BA%92%E6%96%A5%E9%94%81/" style="font-size: 10px;">互斥锁</a> <a href="/tags/%E4%BA%BA%E7%94%9F/" style="font-size: 10px;">人生</a> <a href="/tags/%E4%BC%A0%E8%AE%B0/" style="font-size: 10px;">传记</a> <a href="/tags/%E4%BC%A0%E8%BE%93%E5%B1%82/" style="font-size: 15px;">传输层</a> <a href="/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/" style="font-size: 10px;">信号量</a> <a href="/tags/%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/" style="font-size: 10px;">关联容器</a> <a href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA/" style="font-size: 10px;">内存分区</a> <a href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/" style="font-size: 10px;">内存分配</a> <a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 17.5px;">内核</a> <a href="/tags/%E5%88%9D%E5%A7%8B%E5%8C%96/" style="font-size: 10px;">初始化</a> <a href="/tags/%E5%8A%A8%E6%80%81%E5%A4%9A%E6%80%81/" style="font-size: 10px;">动态多态</a> <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">单例模式</a> <a href="/tags/%E5%90%8D%E8%91%97/" style="font-size: 10px;">名著</a> <a href="/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 11.25px;">命令</a> <a href="/tags/%E5%93%B2%E5%AD%A6/" style="font-size: 10px;">哲学</a> <a href="/tags/%E5%9D%97%E8%AE%BE%E5%A4%87/" style="font-size: 10px;">块设备</a> <a href="/tags/%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84/" style="font-size: 10px;">基本结构</a> <a href="/tags/%E5%A4%9A%E6%80%81/" style="font-size: 10px;">多态</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">多线程</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 10px;">大数据</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E8%AE%A1%E7%AE%97/" style="font-size: 10px;">大数据计算</a> <a href="/tags/%E5%A5%97%E6%8E%A5%E5%AD%97/" style="font-size: 10px;">套接字</a> <a href="/tags/%E5%AD%A6%E6%9C%AF%E8%AE%BA%E6%96%87/" style="font-size: 10px;">学术论文</a> <a href="/tags/%E5%AE%B9%E5%99%A8%E7%B1%BB/" style="font-size: 10px;">容器类</a> <a href="/tags/%E5%B0%81%E8%A3%85/" style="font-size: 10px;">封装</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 11.25px;">工具</a> <a href="/tags/%E5%BA%94%E7%94%A8%E5%B1%82/" style="font-size: 10px;">应用层</a> <a href="/tags/%E5%BF%83%E6%80%81/" style="font-size: 10px;">心态</a> <a href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" style="font-size: 11.25px;">性能分析</a> <a href="/tags/%E6%8C%91%E6%88%98/" style="font-size: 10px;">挑战</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">插件</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">操作系统</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/tags/%E6%95%A3%E5%88%97%E8%A1%A8/" style="font-size: 10px;">散列表</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 12.5px;">数据结构</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8E%E7%9B%AE%E5%BD%95/" style="font-size: 10px;">文件与目录</a> <a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 11.25px;">文件系统</a> <a href="/tags/%E6%96%87%E6%A1%A3%E5%92%8C%E6%B3%A8%E9%87%8A/" style="font-size: 10px;">文档和注释</a> <a href="/tags/%E6%A0%88/" style="font-size: 10px;">栈</a> <a href="/tags/%E6%A1%B6%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">桶排序</a> <a href="/tags/%E6%A6%82%E8%BF%B0/" style="font-size: 11.25px;">概述</a> <a href="/tags/%E6%A8%A1%E5%9D%97/" style="font-size: 10px;">模块</a> <a href="/tags/%E6%B5%85%E6%8B%B7%E8%B4%9D/" style="font-size: 10px;">浅拷贝</a> <a href="/tags/%E6%B7%B1%E6%8B%B7%E8%B4%9D/" style="font-size: 10px;">深拷贝</a> <a href="/tags/%E6%BC%94%E8%AE%B2/" style="font-size: 10px;">演讲</a> <a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size: 10px;">版本控制</a> <a href="/tags/%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">特殊文件系统</a> <a href="/tags/%E7%94%9F%E4%BA%A7%E5%8A%9B/" style="font-size: 10px;">生产力</a> <a href="/tags/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/" style="font-size: 11.25px;">目录结构</a> <a href="/tags/%E7%A0%94%E7%A9%B6%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 10px;">研究方法论</a> <a href="/tags/%E7%A1%AC%E8%BF%9E%E6%8E%A5/" style="font-size: 10px;">硬连接</a> <a href="/tags/%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C/" style="font-size: 10px;">程序执行</a> <a href="/tags/%E7%AE%80%E8%BF%B0/" style="font-size: 10px;">简述</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.75px;">算法</a> <a href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/" style="font-size: 10px;">红黑树</a> <a href="/tags/%E7%BB%83%E4%B9%A0/" style="font-size: 10px;">练习</a> <a href="/tags/%E7%BB%A7%E6%89%BF/" style="font-size: 10px;">继承</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8A%A0%E8%BD%BD/" style="font-size: 10px;">编译加载</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">网络</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">虚拟文件系统</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95/" style="font-size: 10px;">设计方法</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a> <a href="/tags/%E8%AF%B4%E6%98%8E/" style="font-size: 10px;">说明</a> <a href="/tags/%E8%AF%BA%E8%B4%9D%E5%B0%94%E5%A5%96/" style="font-size: 10px;">诺贝尔奖</a> <a href="/tags/%E8%B0%83%E8%AF%95%E5%99%A8/" style="font-size: 10px;">调试器</a> <a href="/tags/%E8%B4%B9%E6%9B%BC/" style="font-size: 10px;">费曼</a> <a href="/tags/%E8%BD%AF%E8%BF%9E%E6%8E%A5/" style="font-size: 10px;">软连接</a> <a href="/tags/%E8%BF%90%E7%AE%97%E7%AC%A6/" style="font-size: 10px;">运算符</a> <a href="/tags/%E9%87%8D%E8%BD%BD/" style="font-size: 10px;">重载</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 10px;">链表</a> <a href="/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">阅读笔记</a> <a href="/tags/%E9%98%9F%E5%88%97/" style="font-size: 10px;">队列</a> <a href="/tags/%E9%9D%99%E6%80%81%E5%A4%9A%E6%80%81/" style="font-size: 10px;">静态多态</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 11.25px;">面向对象</a> <a href="/tags/%E9%9F%B3%E6%A0%87/" style="font-size: 10px;">音标</a> <a href="/tags/%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/" style="font-size: 10px;">顺序容器</a> <a href="/tags/%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/" style="font-size: 13.75px;">驱动程序</a>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/08/22/hello-world/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/article_photo/helloworld.jpg" alt="Hello World">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-22T14:25:42.312Z">2020-08-22</time></div>
                    <a href="/2020/08/22/hello-world/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Hello World</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/%E5%8D%9A%E5%AE%A2%E7%BB%B4%E6%8A%A4/">博客维护</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/08/17/Linux-%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Linux-块设备驱动程序">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-17T13:09:35.000Z">2020-08-17</time></div>
                    <a href="/2020/08/17/Linux-%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Linux-块设备驱动程序</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/08/16/Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%B3%A8%E5%86%8C%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Linux文件系统注册、安装与卸载">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-16T12:11:46.000Z">2020-08-16</time></div>
                    <a href="/2020/08/16/Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%B3%A8%E5%86%8C%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Linux文件系统注册、安装与卸载</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/08/12/Linux-VFS%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Linux-VFS中的数据结构">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-12T04:11:05.000Z">2020-08-12</time></div>
                    <a href="/2020/08/12/Linux-VFS%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Linux-VFS中的数据结构</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/08/11/Linux-%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Linux-特殊文件系统">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-11T03:51:40.000Z">2020-08-11</time></div>
                    <a href="/2020/08/11/Linux-%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Linux-特殊文件系统</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/08/">
                <span class="level-start">
                    <span class="level-item">八月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">七月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">10</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">六月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">17</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">23</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/B-%E6%A0%91/">
                        <span class="tag">B+树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/B-%E6%A0%91/">
                        <span class="tag">B-树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/C/">
                        <span class="tag">C++</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/C-%E6%A0%87%E5%87%86%E5%BA%93/">
                        <span class="tag">C++标准库</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/HTTP/">
                        <span class="tag">HTTP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">19</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux%E6%A6%82%E8%BF%B0/">
                        <span class="tag">Linux概述</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TCP/">
                        <span class="tag">TCP</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UDP/">
                        <span class="tag">UDP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/VFS/">
                        <span class="tag">VFS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chrome/">
                        <span class="tag">chrome</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/deque/">
                        <span class="tag">deque</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/heap/">
                        <span class="tag">heap</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/leetcode/">
                        <span class="tag">leetcode</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/list/">
                        <span class="tag">list</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/map/">
                        <span class="tag">map</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/module/">
                        <span class="tag">module</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pair/">
                        <span class="tag">pair</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/priority-queue/">
                        <span class="tag">priority_queue</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/queue/">
                        <span class="tag">queue</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/set/">
                        <span class="tag">set</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/stack/">
                        <span class="tag">stack</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/string/">
                        <span class="tag">string</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/vector/">
                        <span class="tag">vector</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BA%92%E6%96%A5%E9%94%81/">
                        <span class="tag">互斥锁</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BA%BA%E7%94%9F/">
                        <span class="tag">人生</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BC%A0%E8%AE%B0/">
                        <span class="tag">传记</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BC%A0%E8%BE%93%E5%B1%82/">
                        <span class="tag">传输层</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/">
                        <span class="tag">信号量</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/">
                        <span class="tag">关联容器</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA/">
                        <span class="tag">内存分区</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/">
                        <span class="tag">内存分配</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%86%85%E6%A0%B8/">
                        <span class="tag">内核</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%88%9D%E5%A7%8B%E5%8C%96/">
                        <span class="tag">初始化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%8A%A8%E6%80%81%E5%A4%9A%E6%80%81/">
                        <span class="tag">动态多态</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">
                        <span class="tag">单例模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%90%8D%E8%91%97/">
                        <span class="tag">名著</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%91%BD%E4%BB%A4/">
                        <span class="tag">命令</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%93%B2%E5%AD%A6/">
                        <span class="tag">哲学</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%9D%97%E8%AE%BE%E5%A4%87/">
                        <span class="tag">块设备</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84/">
                        <span class="tag">基本结构</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A4%9A%E6%80%81/">
                        <span class="tag">多态</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">
                        <span class="tag">多线程</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">
                        <span class="tag">大数据</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E8%AE%A1%E7%AE%97/">
                        <span class="tag">大数据计算</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A5%97%E6%8E%A5%E5%AD%97/">
                        <span class="tag">套接字</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%AD%A6%E6%9C%AF%E8%AE%BA%E6%96%87/">
                        <span class="tag">学术论文</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%AE%B9%E5%99%A8%E7%B1%BB/">
                        <span class="tag">容器类</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%B0%81%E8%A3%85/">
                        <span class="tag">封装</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%BA%94%E7%94%A8%E5%B1%82/">
                        <span class="tag">应用层</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%BF%83%E6%80%81/">
                        <span class="tag">心态</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">
                        <span class="tag">性能分析</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%8C%91%E6%88%98/">
                        <span class="tag">挑战</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%8F%92%E4%BB%B6/">
                        <span class="tag">插件</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
                        <span class="tag">操作系统</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%95%99%E7%A8%8B/">
                        <span class="tag">教程</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%95%A3%E5%88%97%E8%A1%A8/">
                        <span class="tag">散列表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8E%E7%9B%AE%E5%BD%95/">
                        <span class="tag">文件与目录</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">
                        <span class="tag">文件系统</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%96%87%E6%A1%A3%E5%92%8C%E6%B3%A8%E9%87%8A/">
                        <span class="tag">文档和注释</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%A0%88/">
                        <span class="tag">栈</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%A1%B6%E6%8E%92%E5%BA%8F/">
                        <span class="tag">桶排序</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%A6%82%E8%BF%B0/">
                        <span class="tag">概述</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%A8%A1%E5%9D%97/">
                        <span class="tag">模块</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%B5%85%E6%8B%B7%E8%B4%9D/">
                        <span class="tag">浅拷贝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%B7%B1%E6%8B%B7%E8%B4%9D/">
                        <span class="tag">深拷贝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%BC%94%E8%AE%B2/">
                        <span class="tag">演讲</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/">
                        <span class="tag">版本控制</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">
                        <span class="tag">特殊文件系统</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%94%9F%E4%BA%A7%E5%8A%9B/">
                        <span class="tag">生产力</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/">
                        <span class="tag">目录结构</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%A0%94%E7%A9%B6%E6%96%B9%E6%B3%95%E8%AE%BA/">
                        <span class="tag">研究方法论</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%A1%AC%E8%BF%9E%E6%8E%A5/">
                        <span class="tag">硬连接</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C/">
                        <span class="tag">程序执行</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%AE%80%E8%BF%B0/">
                        <span class="tag">简述</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/">
                        <span class="tag">红黑树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BB%83%E4%B9%A0/">
                        <span class="tag">练习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BB%A7%E6%89%BF/">
                        <span class="tag">继承</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BC%96%E8%AF%91%E5%8A%A0%E8%BD%BD/">
                        <span class="tag">编译加载</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BD%91%E7%BB%9C/">
                        <span class="tag">网络</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">
                        <span class="tag">虚拟文件系统</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
                        <span class="tag">计算机网络</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95/">
                        <span class="tag">设计方法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AF%B4%E6%98%8E/">
                        <span class="tag">说明</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AF%BA%E8%B4%9D%E5%B0%94%E5%A5%96/">
                        <span class="tag">诺贝尔奖</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%B0%83%E8%AF%95%E5%99%A8/">
                        <span class="tag">调试器</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%B4%B9%E6%9B%BC/">
                        <span class="tag">费曼</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%BD%AF%E8%BF%9E%E6%8E%A5/">
                        <span class="tag">软连接</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%BF%90%E7%AE%97%E7%AC%A6/">
                        <span class="tag">运算符</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%87%8D%E8%BD%BD/">
                        <span class="tag">重载</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%93%BE%E8%A1%A8/">
                        <span class="tag">链表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">
                        <span class="tag">阅读笔记</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%98%9F%E5%88%97/">
                        <span class="tag">队列</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9D%99%E6%80%81%E5%A4%9A%E6%80%81/">
                        <span class="tag">静态多态</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">
                        <span class="tag">面向对象</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9F%B3%E6%A0%87/">
                        <span class="tag">音标</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/">
                        <span class="tag">顺序容器</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/">
                        <span class="tag">驱动程序</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>
 -->
               <!--  -->
			   <!-- 下面几行是调整3栏变两栏的代码-->
			     




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="STEMHA">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        STEMHA
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        student
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            71
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            14
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            103
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/STEMHA" target="_blank" rel="noopener">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/STEMHA">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/rss.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        

    <div class="card widget" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    目录
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#概述">
        <span class="has-mr-6">1</span>
        <span>概述</span>
        </a></li><li>
        <a class="is-flex" href="#文件系统的注册">
        <span class="has-mr-6">2</span>
        <span>文件系统的注册</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#file-system-type数据结构">
        <span class="has-mr-6">2.1</span>
        <span>file_system_type数据结构</span>
        </a></li><li>
        <a class="is-flex" href="#register-filesystem-注册函数">
        <span class="has-mr-6">2.2</span>
        <span>register_filesystem()注册函数</span>
        </a></li><li>
        <a class="is-flex" href="#unregister-filesystem-撤销注册">
        <span class="has-mr-6">2.3</span>
        <span>unregister_filesystem()撤销注册</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#文件系统的安装">
        <span class="has-mr-6">3</span>
        <span>文件系统的安装</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#mount命令">
        <span class="has-mr-6">3.1</span>
        <span>mount命令</span>
        </a></li><li>
        <a class="is-flex" href="#vfsmount数据结构">
        <span class="has-mr-6">3.2</span>
        <span>vfsmount数据结构</span>
        </a></li><li>
        <a class="is-flex" href="#struct-mount结构">
        <span class="has-mr-6">3.3</span>
        <span>struct mount结构</span>
        </a></li><li>
        <a class="is-flex" href="#安装根文件系统">
        <span class="has-mr-6">3.4</span>
        <span>安装根文件系统</span>
        </a></li><li>
        <a class="is-flex" href="#安装一个常规文件系统">
        <span class="has-mr-6">3.5</span>
        <span>安装一个常规文件系统</span>
        </a></li><li>
        <a class="is-flex" href="#sys-mount-函数">
        <span class="has-mr-6">3.6</span>
        <span>sys_mount()函数</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#文件系统的卸载">
        <span class="has-mr-6">4</span>
        <span>文件系统的卸载</span>
        </a></li><li>
        <a class="is-flex" href="#参考资料">
        <span class="has-mr-6">5</span>
        <span>参考资料</span>
        </a></li><li>
        <a class="is-flex" href="#注解">
        <span class="has-mr-6">6</span>
        <span>注解</span>
        </a></li></ul>
            </div>
        </div>
    </div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/ppoffice" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/STEMHA" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">GitHub - STEMHA</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/C/">
            <span class="level-start">
                <span class="level-item">C++</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">18</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Linux/">
            <span class="level-start">
                <span class="level-item">Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">20</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E5%8D%9A%E5%AE%A2%E7%BB%B4%E6%8A%A4/">
            <span class="level-start">
                <span class="level-item">博客维护</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E5%AD%A6%E6%9C%AF%E8%AE%BA%E6%96%87/">
            <span class="level-start">
                <span class="level-item">学术论文</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
            <span class="level-start">
                <span class="level-item">操作系统</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/">
            <span class="level-start">
                <span class="level-item">效率工具</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
            <span class="level-start">
                <span class="level-item">数据结构</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E7%AE%97%E6%B3%95/">
            <span class="level-start">
                <span class="level-item">算法</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/">
            <span class="level-start">
                <span class="level-item">英语学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
            <span class="level-start">
                <span class="level-item">计算机网络</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">
            <span class="level-start">
                <span class="level-item">读书笔记</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%AF%BE%E5%A4%96%E5%AD%A6%E6%9C%AF%E9%98%85%E8%AF%BB/">
            <span class="level-start">
                <span class="level-item">课外学术阅读</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">
            <span class="level-start">
                <span class="level-item">软件工程</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E9%86%92%E4%B8%96%E9%80%9A%E8%A8%80/">
            <span class="level-start">
                <span class="level-item">醒世通言</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/B-%E6%A0%91/" style="font-size: 10px;">B+树</a> <a href="/tags/B-%E6%A0%91/" style="font-size: 10px;">B-树</a> <a href="/tags/C/" style="font-size: 16.25px;">C++</a> <a href="/tags/C-%E6%A0%87%E5%87%86%E5%BA%93/" style="font-size: 18.75px;">C++标准库</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Linux%E6%A6%82%E8%BF%B0/" style="font-size: 10px;">Linux概述</a> <a href="/tags/TCP/" style="font-size: 13.75px;">TCP</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/VFS/" style="font-size: 10px;">VFS</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/deque/" style="font-size: 10px;">deque</a> <a href="/tags/heap/" style="font-size: 10px;">heap</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/leetcode/" style="font-size: 10px;">leetcode</a> <a href="/tags/list/" style="font-size: 10px;">list</a> <a href="/tags/map/" style="font-size: 10px;">map</a> <a href="/tags/module/" style="font-size: 10px;">module</a> <a href="/tags/pair/" style="font-size: 10px;">pair</a> <a href="/tags/priority-queue/" style="font-size: 10px;">priority_queue</a> <a href="/tags/queue/" style="font-size: 10px;">queue</a> <a href="/tags/set/" style="font-size: 10px;">set</a> <a href="/tags/stack/" style="font-size: 10px;">stack</a> <a href="/tags/string/" style="font-size: 10px;">string</a> <a href="/tags/vector/" style="font-size: 10px;">vector</a> <a href="/tags/%E4%BA%92%E6%96%A5%E9%94%81/" style="font-size: 10px;">互斥锁</a> <a href="/tags/%E4%BA%BA%E7%94%9F/" style="font-size: 10px;">人生</a> <a href="/tags/%E4%BC%A0%E8%AE%B0/" style="font-size: 10px;">传记</a> <a href="/tags/%E4%BC%A0%E8%BE%93%E5%B1%82/" style="font-size: 15px;">传输层</a> <a href="/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/" style="font-size: 10px;">信号量</a> <a href="/tags/%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/" style="font-size: 10px;">关联容器</a> <a href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA/" style="font-size: 10px;">内存分区</a> <a href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/" style="font-size: 10px;">内存分配</a> <a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 17.5px;">内核</a> <a href="/tags/%E5%88%9D%E5%A7%8B%E5%8C%96/" style="font-size: 10px;">初始化</a> <a href="/tags/%E5%8A%A8%E6%80%81%E5%A4%9A%E6%80%81/" style="font-size: 10px;">动态多态</a> <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">单例模式</a> <a href="/tags/%E5%90%8D%E8%91%97/" style="font-size: 10px;">名著</a> <a href="/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 11.25px;">命令</a> <a href="/tags/%E5%93%B2%E5%AD%A6/" style="font-size: 10px;">哲学</a> <a href="/tags/%E5%9D%97%E8%AE%BE%E5%A4%87/" style="font-size: 10px;">块设备</a> <a href="/tags/%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84/" style="font-size: 10px;">基本结构</a> <a href="/tags/%E5%A4%9A%E6%80%81/" style="font-size: 10px;">多态</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">多线程</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 10px;">大数据</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E8%AE%A1%E7%AE%97/" style="font-size: 10px;">大数据计算</a> <a href="/tags/%E5%A5%97%E6%8E%A5%E5%AD%97/" style="font-size: 10px;">套接字</a> <a href="/tags/%E5%AD%A6%E6%9C%AF%E8%AE%BA%E6%96%87/" style="font-size: 10px;">学术论文</a> <a href="/tags/%E5%AE%B9%E5%99%A8%E7%B1%BB/" style="font-size: 10px;">容器类</a> <a href="/tags/%E5%B0%81%E8%A3%85/" style="font-size: 10px;">封装</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 11.25px;">工具</a> <a href="/tags/%E5%BA%94%E7%94%A8%E5%B1%82/" style="font-size: 10px;">应用层</a> <a href="/tags/%E5%BF%83%E6%80%81/" style="font-size: 10px;">心态</a> <a href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" style="font-size: 11.25px;">性能分析</a> <a href="/tags/%E6%8C%91%E6%88%98/" style="font-size: 10px;">挑战</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">插件</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">操作系统</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/tags/%E6%95%A3%E5%88%97%E8%A1%A8/" style="font-size: 10px;">散列表</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 12.5px;">数据结构</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8E%E7%9B%AE%E5%BD%95/" style="font-size: 10px;">文件与目录</a> <a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 11.25px;">文件系统</a> <a href="/tags/%E6%96%87%E6%A1%A3%E5%92%8C%E6%B3%A8%E9%87%8A/" style="font-size: 10px;">文档和注释</a> <a href="/tags/%E6%A0%88/" style="font-size: 10px;">栈</a> <a href="/tags/%E6%A1%B6%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">桶排序</a> <a href="/tags/%E6%A6%82%E8%BF%B0/" style="font-size: 11.25px;">概述</a> <a href="/tags/%E6%A8%A1%E5%9D%97/" style="font-size: 10px;">模块</a> <a href="/tags/%E6%B5%85%E6%8B%B7%E8%B4%9D/" style="font-size: 10px;">浅拷贝</a> <a href="/tags/%E6%B7%B1%E6%8B%B7%E8%B4%9D/" style="font-size: 10px;">深拷贝</a> <a href="/tags/%E6%BC%94%E8%AE%B2/" style="font-size: 10px;">演讲</a> <a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size: 10px;">版本控制</a> <a href="/tags/%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">特殊文件系统</a> <a href="/tags/%E7%94%9F%E4%BA%A7%E5%8A%9B/" style="font-size: 10px;">生产力</a> <a href="/tags/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/" style="font-size: 11.25px;">目录结构</a> <a href="/tags/%E7%A0%94%E7%A9%B6%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 10px;">研究方法论</a> <a href="/tags/%E7%A1%AC%E8%BF%9E%E6%8E%A5/" style="font-size: 10px;">硬连接</a> <a href="/tags/%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C/" style="font-size: 10px;">程序执行</a> <a href="/tags/%E7%AE%80%E8%BF%B0/" style="font-size: 10px;">简述</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.75px;">算法</a> <a href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/" style="font-size: 10px;">红黑树</a> <a href="/tags/%E7%BB%83%E4%B9%A0/" style="font-size: 10px;">练习</a> <a href="/tags/%E7%BB%A7%E6%89%BF/" style="font-size: 10px;">继承</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8A%A0%E8%BD%BD/" style="font-size: 10px;">编译加载</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">网络</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">虚拟文件系统</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95/" style="font-size: 10px;">设计方法</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a> <a href="/tags/%E8%AF%B4%E6%98%8E/" style="font-size: 10px;">说明</a> <a href="/tags/%E8%AF%BA%E8%B4%9D%E5%B0%94%E5%A5%96/" style="font-size: 10px;">诺贝尔奖</a> <a href="/tags/%E8%B0%83%E8%AF%95%E5%99%A8/" style="font-size: 10px;">调试器</a> <a href="/tags/%E8%B4%B9%E6%9B%BC/" style="font-size: 10px;">费曼</a> <a href="/tags/%E8%BD%AF%E8%BF%9E%E6%8E%A5/" style="font-size: 10px;">软连接</a> <a href="/tags/%E8%BF%90%E7%AE%97%E7%AC%A6/" style="font-size: 10px;">运算符</a> <a href="/tags/%E9%87%8D%E8%BD%BD/" style="font-size: 10px;">重载</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 10px;">链表</a> <a href="/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">阅读笔记</a> <a href="/tags/%E9%98%9F%E5%88%97/" style="font-size: 10px;">队列</a> <a href="/tags/%E9%9D%99%E6%80%81%E5%A4%9A%E6%80%81/" style="font-size: 10px;">静态多态</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 11.25px;">面向对象</a> <a href="/tags/%E9%9F%B3%E6%A0%87/" style="font-size: 10px;">音标</a> <a href="/tags/%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/" style="font-size: 10px;">顺序容器</a> <a href="/tags/%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/" style="font-size: 13.75px;">驱动程序</a>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/08/22/hello-world/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/article_photo/helloworld.jpg" alt="Hello World">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-22T14:25:42.312Z">2020-08-22</time></div>
                    <a href="/2020/08/22/hello-world/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Hello World</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/%E5%8D%9A%E5%AE%A2%E7%BB%B4%E6%8A%A4/">博客维护</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/08/17/Linux-%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Linux-块设备驱动程序">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-17T13:09:35.000Z">2020-08-17</time></div>
                    <a href="/2020/08/17/Linux-%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Linux-块设备驱动程序</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/08/16/Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%B3%A8%E5%86%8C%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Linux文件系统注册、安装与卸载">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-16T12:11:46.000Z">2020-08-16</time></div>
                    <a href="/2020/08/16/Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%B3%A8%E5%86%8C%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Linux文件系统注册、安装与卸载</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/08/12/Linux-VFS%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Linux-VFS中的数据结构">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-12T04:11:05.000Z">2020-08-12</time></div>
                    <a href="/2020/08/12/Linux-VFS%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Linux-VFS中的数据结构</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/08/11/Linux-%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Linux-特殊文件系统">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-11T03:51:40.000Z">2020-08-11</time></div>
                    <a href="/2020/08/11/Linux-%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Linux-特殊文件系统</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/08/">
                <span class="level-start">
                    <span class="level-item">八月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">七月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">10</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">六月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">17</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">23</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/B-%E6%A0%91/">
                        <span class="tag">B+树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/B-%E6%A0%91/">
                        <span class="tag">B-树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/C/">
                        <span class="tag">C++</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/C-%E6%A0%87%E5%87%86%E5%BA%93/">
                        <span class="tag">C++标准库</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/HTTP/">
                        <span class="tag">HTTP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">19</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux%E6%A6%82%E8%BF%B0/">
                        <span class="tag">Linux概述</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TCP/">
                        <span class="tag">TCP</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UDP/">
                        <span class="tag">UDP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/VFS/">
                        <span class="tag">VFS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chrome/">
                        <span class="tag">chrome</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/deque/">
                        <span class="tag">deque</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/heap/">
                        <span class="tag">heap</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/leetcode/">
                        <span class="tag">leetcode</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/list/">
                        <span class="tag">list</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/map/">
                        <span class="tag">map</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/module/">
                        <span class="tag">module</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pair/">
                        <span class="tag">pair</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/priority-queue/">
                        <span class="tag">priority_queue</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/queue/">
                        <span class="tag">queue</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/set/">
                        <span class="tag">set</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/stack/">
                        <span class="tag">stack</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/string/">
                        <span class="tag">string</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/vector/">
                        <span class="tag">vector</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BA%92%E6%96%A5%E9%94%81/">
                        <span class="tag">互斥锁</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BA%BA%E7%94%9F/">
                        <span class="tag">人生</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BC%A0%E8%AE%B0/">
                        <span class="tag">传记</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BC%A0%E8%BE%93%E5%B1%82/">
                        <span class="tag">传输层</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/">
                        <span class="tag">信号量</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/">
                        <span class="tag">关联容器</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA/">
                        <span class="tag">内存分区</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/">
                        <span class="tag">内存分配</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%86%85%E6%A0%B8/">
                        <span class="tag">内核</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%88%9D%E5%A7%8B%E5%8C%96/">
                        <span class="tag">初始化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%8A%A8%E6%80%81%E5%A4%9A%E6%80%81/">
                        <span class="tag">动态多态</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">
                        <span class="tag">单例模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%90%8D%E8%91%97/">
                        <span class="tag">名著</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%91%BD%E4%BB%A4/">
                        <span class="tag">命令</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%93%B2%E5%AD%A6/">
                        <span class="tag">哲学</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%9D%97%E8%AE%BE%E5%A4%87/">
                        <span class="tag">块设备</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84/">
                        <span class="tag">基本结构</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A4%9A%E6%80%81/">
                        <span class="tag">多态</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">
                        <span class="tag">多线程</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">
                        <span class="tag">大数据</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E8%AE%A1%E7%AE%97/">
                        <span class="tag">大数据计算</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%A5%97%E6%8E%A5%E5%AD%97/">
                        <span class="tag">套接字</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%AD%A6%E6%9C%AF%E8%AE%BA%E6%96%87/">
                        <span class="tag">学术论文</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%AE%B9%E5%99%A8%E7%B1%BB/">
                        <span class="tag">容器类</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%B0%81%E8%A3%85/">
                        <span class="tag">封装</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%BA%94%E7%94%A8%E5%B1%82/">
                        <span class="tag">应用层</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%BF%83%E6%80%81/">
                        <span class="tag">心态</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">
                        <span class="tag">性能分析</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%8C%91%E6%88%98/">
                        <span class="tag">挑战</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%8F%92%E4%BB%B6/">
                        <span class="tag">插件</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
                        <span class="tag">操作系统</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%95%99%E7%A8%8B/">
                        <span class="tag">教程</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%95%A3%E5%88%97%E8%A1%A8/">
                        <span class="tag">散列表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8E%E7%9B%AE%E5%BD%95/">
                        <span class="tag">文件与目录</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">
                        <span class="tag">文件系统</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%96%87%E6%A1%A3%E5%92%8C%E6%B3%A8%E9%87%8A/">
                        <span class="tag">文档和注释</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%A0%88/">
                        <span class="tag">栈</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%A1%B6%E6%8E%92%E5%BA%8F/">
                        <span class="tag">桶排序</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%A6%82%E8%BF%B0/">
                        <span class="tag">概述</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%A8%A1%E5%9D%97/">
                        <span class="tag">模块</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%B5%85%E6%8B%B7%E8%B4%9D/">
                        <span class="tag">浅拷贝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%B7%B1%E6%8B%B7%E8%B4%9D/">
                        <span class="tag">深拷贝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%BC%94%E8%AE%B2/">
                        <span class="tag">演讲</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/">
                        <span class="tag">版本控制</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">
                        <span class="tag">特殊文件系统</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%94%9F%E4%BA%A7%E5%8A%9B/">
                        <span class="tag">生产力</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/">
                        <span class="tag">目录结构</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%A0%94%E7%A9%B6%E6%96%B9%E6%B3%95%E8%AE%BA/">
                        <span class="tag">研究方法论</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%A1%AC%E8%BF%9E%E6%8E%A5/">
                        <span class="tag">硬连接</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C/">
                        <span class="tag">程序执行</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%AE%80%E8%BF%B0/">
                        <span class="tag">简述</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/">
                        <span class="tag">红黑树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BB%83%E4%B9%A0/">
                        <span class="tag">练习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BB%A7%E6%89%BF/">
                        <span class="tag">继承</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BC%96%E8%AF%91%E5%8A%A0%E8%BD%BD/">
                        <span class="tag">编译加载</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BD%91%E7%BB%9C/">
                        <span class="tag">网络</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">
                        <span class="tag">虚拟文件系统</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
                        <span class="tag">计算机网络</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95/">
                        <span class="tag">设计方法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AF%B4%E6%98%8E/">
                        <span class="tag">说明</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AF%BA%E8%B4%9D%E5%B0%94%E5%A5%96/">
                        <span class="tag">诺贝尔奖</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%B0%83%E8%AF%95%E5%99%A8/">
                        <span class="tag">调试器</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%B4%B9%E6%9B%BC/">
                        <span class="tag">费曼</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%BD%AF%E8%BF%9E%E6%8E%A5/">
                        <span class="tag">软连接</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%BF%90%E7%AE%97%E7%AC%A6/">
                        <span class="tag">运算符</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%87%8D%E8%BD%BD/">
                        <span class="tag">重载</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%93%BE%E8%A1%A8/">
                        <span class="tag">链表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">
                        <span class="tag">阅读笔记</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%98%9F%E5%88%97/">
                        <span class="tag">队列</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9D%99%E6%80%81%E5%A4%9A%E6%80%81/">
                        <span class="tag">静态多态</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">
                        <span class="tag">面向对象</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9F%B3%E6%A0%87/">
                        <span class="tag">音标</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/">
                        <span class="tag">顺序容器</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/">
                        <span class="tag">驱动程序</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

				 
				 
				  <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main twoLine">
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-08-16T12:11:46.000Z">2020-08-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    44 分钟 读完 (大约 6674 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Linux文件系统注册、安装与卸载
            
        </h1>
        <div class="content">
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a><strong>概述</strong></h2><blockquote>
<p>当内核被编译时，就已经确定了可以支持哪些文件系统，这些文件系统在系统引导时，在 VFS 中进行注册。如果文件系统是作为内核可装载的模块，则在实际安装时进行注册，并在模块卸载时注销。</p>
<ul>
<li>VFS的初始化函数用来向VFS注册，即填写<code>文件注册表file_system_type数据结构</code>。每一个文件系统类型在注册表中有一个登记项，记录该文件系统的类型名、文件系统特性、指向对应的VFS超级块读取函数的地址及已注册项的链指针等。</li>
<li>函数<code>register_filesystem()</code>用于注册文件系统类型，函数<code>unregister_filesystem()</code>用于注销一个文件系统类型。</li>
</ul>
</blockquote>
<a id="more"></a>

<h2 id="文件系统的注册"><a href="#文件系统的注册" class="headerlink" title="文件系统的注册"></a><strong>文件系统的注册</strong></h2><p>VFS以链表的形式管理已经注册的文件系统。文件系统的注册有两种途径：</p>
<ul>
<li>第一种是编译操作系统内核的时候确定了可以支持那性文件系统，在文件系统被引导是，在VFS中进行注册。</li>
<li>第二种是文件系统被当作可装载模块，通过insmod/rmmod命令在装入该文件系统模块时向VFS注册。</li>
</ul>
<p><code>文件系统的初始化例程</code>：每个文件系统都有一个初始化例程，它的作用就是在VFS中进行注册，即填写一个叫 file_system_type 的数据结构。</p>
<h3 id="file-system-type数据结构"><a href="#file-system-type数据结构" class="headerlink" title="file_system_type数据结构"></a><strong>file_system_type数据结构</strong></h3><ul>
<li>file_system_type结构包含了文件系统的名称以及一个指向对应的 VFS 超级块读取例程的地址。</li>
<li>所有已注册的文件系统的<strong>file_system_type 结构形成一个链表</strong>，为区别后面将要说到的已安装的文件系统形成的另一个链表，我们把这个链表称为<code>注册链表</code>。</li>
<li>这个注册链表是一个临界资源，受file_systems_lock 自旋读写锁的保护。</li>
</ul>
<p>图1所示就是内核中的 file_system_type 链表，链表头由file_systems变量指定。图1仅示意性地说明系统中已安装的3个文件系统Ext2、proc、iso9660 其file_system_type 结构所形成的链表。</p>
<center><img src="/2020/08/16/Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%B3%A8%E5%86%8C%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/已注册的文件系统形成的链表.PNG">  </center>
<center>图1. 已注册的文件系统形成的链表.PNG</center>



<p>file_system_type数据结构在<a href="https://github.com/torvalds/linux/blob/v3.10/include/linux/fs.h">include/linux/fs.h</a>中定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> &#123;</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *name;     <span class="comment">// 文件系统的类型名，以字符串的形式出现</span></span><br><span class="line">	<span class="keyword">int</span> fs_flags;          <span class="comment">//指明具体文件系统的一些特性。</span></span><br><span class="line">	<span class="comment">/* public flags for file_system_type */</span>  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_REQUIRES_DEV		1 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_BINARY_MOUNTDATA	2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_HAS_SUBTYPE		4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_USERNS_MOUNT		8	<span class="comment">/* Can be mounted by userns root */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_USERNS_DEV_MOUNT	16 <span class="comment">/* A userns mount does not imply MNT_NODEV */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FS_RENAME_DOES_D_MOVE	32768	<span class="comment">/* FS will handle d_move() during rename() internally. */</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dentry</span> *(*<span class="title">mount</span>) (<span class="title">struct</span> <span class="title">file_system_type</span> *, <span class="title">int</span>,</span></span><br><span class="line"><span class="class">		       <span class="title">const</span> <span class="title">char</span> *, <span class="title">void</span> *);</span></span><br><span class="line">	<span class="keyword">void</span> (*kill_sb) (struct super_block *);  <span class="comment">//删除超级块的方法</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">module</span> *<span class="title">owner</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> * <span class="title">next</span>;</span> <span class="comment">//把所有的file_system_type 结构链接成单项链表的链接指针</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">hlist_head</span> <span class="title">fs_supers</span>;</span>    <span class="comment">//具有相同文件系统类型的超级块对象链表的头</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">s_lock_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">s_umount_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">s_vfs_rename_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">s_writers_key</span>[<span class="title">SB_FREEZE_LEVELS</span>];</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">i_lock_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">i_mutex_key</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">i_mutex_dir_key</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>fs_flags字段存放几个标志，的说明如下：<ul>
<li>FS_REQUIRES_DEV：这种类型的任何文件系统必须位于物理磁盘设备上</li>
<li>FS_BINARY_MOUNTDATA：文件系统使用的二进制安装数据</li>
<li>一般的文件系统类型要求有物理的设备作为其物质基础，其fs_flags 中的<code>FS_REQUIRES_DEV 标志位</code>为1，这些文件系统如Ext2、Minix、ufs 等。</li>
</ul>
</li>
<li>next：把所有的file_system_type 结构链接成单项链表的链接指针， 变量file_systems 指向这个链表。这个链表是一个临界资源，受<code>file_systems_lock</code> 自旋读写锁的保护。</li>
<li>owner：如果file_system_type 所代表的文件系统是通过可安装模块实现的，则该指针指向代表着具体模块的module 结构。如果文件系统是静态地链接到内核，则这个域为NULL。实际上，你只需要把这个域置为THIS_MODLUE （这是个一个宏），它就能自动地完成上述工作。</li>
<li>fs_supers：一个双向链表。链表中的元素是超级块结构。每个文件系统都有一个超级块，但有些文件系统可能被安装在不同的设备上，而且每个具体的设备都有一个超级块，这些超级块就形成一个双向链表。链表元素的向前和向后链接存放在超级块的s_instances字段中。</li>
<li>kill_sb字段指向删除超级块的函数。</li>
</ul>
<h3 id="register-filesystem-注册函数"><a href="#register-filesystem-注册函数" class="headerlink" title="register_filesystem()注册函数"></a><strong>register_filesystem()注册函数</strong></h3><p>搞清楚这个数据结构的各个域以后， 就很容易理解下面的注册函数register_filesystem()，该函数定义于<a href="https://github.com/torvalds/linux/blob/v3.10/fs/filesystems.c">fs/filesystems.c</a>：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	register_filesystem - register a new filesystem</span></span><br><span class="line"><span class="comment"> *	@fs: the file system structure</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	Adds the file system passed to the list of file systems the kernel</span></span><br><span class="line"><span class="comment"> *	is aware of for mount and other syscalls. Returns 0 on success,</span></span><br><span class="line"><span class="comment"> *	or a negative errno code on an error.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	The &amp;struct file_system_type that is passed is linked into the kernel </span></span><br><span class="line"><span class="comment"> *	structures and must not be freed until the file system has been</span></span><br><span class="line"><span class="comment"> *	unregistered.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">register_filesystem</span><span class="params">(struct file_system_type * fs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> ** <span class="title">p</span>;</span></span><br><span class="line"></span><br><span class="line">	BUG_ON(<span class="built_in">strchr</span>(fs-&gt;name, <span class="string">'.'</span>));</span><br><span class="line">	<span class="keyword">if</span> (fs-&gt;next)</span><br><span class="line">		<span class="keyword">return</span> -EBUSY;</span><br><span class="line">	write_lock(&amp;file_systems_lock);  <span class="comment">//对该链表的查找加了写锁write_lock</span></span><br><span class="line">	p = find_filesystem(fs-&gt;name, <span class="built_in">strlen</span>(fs-&gt;name));</span><br><span class="line">	<span class="keyword">if</span> (*p)</span><br><span class="line">		res = -EBUSY;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		*p = fs;</span><br><span class="line">	write_unlock(&amp;file_systems_lock);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EXPORT_SYMBOL(register_filesystem);</span><br></pre></td></tr></table></figure>
<p>find_filesystem()函数在同一个文件中定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> struct file_system_type **<span class="title">find_filesystem</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">unsigned</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> **<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">for</span> (p=&amp;file_systems; *p; p=&amp;(*p)-&gt;next)</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">strlen</span>((*p)-&gt;name) == len &amp;&amp;</span><br><span class="line">		    <span class="built_in">strncmp</span>((*p)-&gt;name, name, len) == <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="icon has-text-warning"><i class="fas fa-exclamation-triangle"></i></span>注意，对注册链表的操作必须互斥地进行，因此，对该链表的查找加了写锁write_lock。</p>
<h3 id="unregister-filesystem-撤销注册"><a href="#unregister-filesystem-撤销注册" class="headerlink" title="unregister_filesystem()撤销注册"></a><strong>unregister_filesystem()撤销注册</strong></h3><p>文件系统注册后，还可以撤消这个注册，即从注册链表中删除一个<code>file_system_type结构</code>，此后系统不再支持该种文件系统。<br><a href="https://github.com/torvalds/linux/blob/v3.10/fs/filesystems.c">fs/filesystems.c</a>中的unregister_filesystem()函数就是起这个作用的，它在执行成功后返回0，如果注册链表中本来就没有指定的要删除的结构，则返回-1，其代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	unregister_filesystem - unregister a file system</span></span><br><span class="line"><span class="comment"> *	@fs: filesystem to unregister</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	Remove a file system that was previously successfully registered</span></span><br><span class="line"><span class="comment"> *	with the kernel. An error is returned if the file system is not found.</span></span><br><span class="line"><span class="comment"> *	Zero is returned on a success.</span></span><br><span class="line"><span class="comment"> *	</span></span><br><span class="line"><span class="comment"> *	Once this function has returned the &amp;struct file_system_type structure</span></span><br><span class="line"><span class="comment"> *	may be freed or reused.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">unregister_filesystem</span><span class="params">(struct file_system_type * fs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> ** <span class="title">tmp</span>;</span></span><br><span class="line"></span><br><span class="line">	write_lock(&amp;file_systems_lock);</span><br><span class="line">	tmp = &amp;file_systems;</span><br><span class="line">	<span class="keyword">while</span> (*tmp) &#123;</span><br><span class="line">		<span class="keyword">if</span> (fs == *tmp) &#123;</span><br><span class="line">			*tmp = fs-&gt;next;</span><br><span class="line">			fs-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">			write_unlock(&amp;file_systems_lock);</span><br><span class="line">			synchronize_rcu();</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		tmp = &amp;(*tmp)-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	write_unlock(&amp;file_systems_lock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> -EINVAL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EXPORT_SYMBOL(unregister_filesystem);</span><br></pre></td></tr></table></figure>

<h2 id="文件系统的安装"><a href="#文件系统的安装" class="headerlink" title="文件系统的安装"></a><strong>文件系统的安装</strong></h2><blockquote>
<p>安装一个文件系统时，内核首先要检查参数的合法性，VFS通过查找由file_systems（file_system_type的首结点）指向的注册表，寻找匹配的file_system_type，就可获得读取文件系统超级块函数的地址，接着查找作为新文件系统安装点的VFS inode,VFS安装程序必须分配一个VFS超级块，然后读入安装文件系统的超级块，并进行填充，再申请一个vfsmount数据结构（其中包含了文件系统所在的块设备的标识、安装点及指向VFS超级块的指针等），使它的指针指向所分配的VFS超级块。当文件系统安装以后，它的根inode便常驻在inode高速缓存中。<br>总的来说，安装过程的主要工作是：创建安装点对象、将其挂接到根文件系统的指定安装点下、初始化超级块对象从而获得文件系统的基本信息和相关的操作。</p>
</blockquote>
<p>要使用一个文件系统，仅仅注册是不行的，还必须安装这个文件系统。</p>
<ul>
<li>Linux使用系统的<code>根文件系统(system&#39;s root filesystem)</code>，它由内核在引导阶段直接安装，并拥有系统初始化脚本以及最基本的系统程序。在安装Linux 时，硬盘上已经有一个分区安装了ext3文件系统（也可能是其他种类的系统），它是作为根文件系统的，根文件系统在启动时自动安装。其实，在系统启动后你所看到的文件系统，都是在启动时安装的。</li>
<li>其他文件系统要么由初始化脚本安装，要么由用户直接安装在已安装文件系统的目录上。</li>
</ul>
<p>作为一个目录树，每个文件系统都拥有自己的根目录(root directory)。安装文件系统的这个目录称之为<code>安装点(mount point)</code>。已安装文件系统属于安装点目录的一个子文件系统。</p>
<ul>
<li>例如，/proc虚拟文件系统是系统的根文件系统的孩子(且系统的根文件系统是/proc的父亲)。</li>
<li>已安装文件系统的根目录隐藏了父文件系统的安装点目录原来的内容，而且父文件系统的整个子树位于安装点之下。</li>
</ul>
<h3 id="mount命令"><a href="#mount命令" class="headerlink" title="mount命令"></a><strong>mount命令</strong></h3><p>如果需要自己（一般是超级用户）<strong>安装文件系统</strong>，则需要指定3 种信息：文件系统的<strong>名称</strong>、包含文件系统的<strong>物理块设备</strong>、文件系统在已有文件系统中的<strong>安装点</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext3 /dev/sda5 /mnt</span><br></pre></td></tr></table></figure>
<ul>
<li>ext3 就是文件系统的名称</li>
<li>/dev/sda5 是包含文件系统的物理块设备，</li>
<li>/mnt 是将要安装到的目录，即安装点。</li>
<li>从这个例子可以看出，安装一个文件系统实际上是安装一个物理设备。</li>
</ul>
<h3 id="vfsmount数据结构"><a href="#vfsmount数据结构" class="headerlink" title="vfsmount数据结构"></a><strong>vfsmount数据结构</strong></h3><p>把一个文件系统（或设备）安装到一个目录点时要用到的主要数据结构为<code>vfsmount</code>和<code>struct mount</code>，定义于<a href="https://github.com/torvalds/linux/blob/v3.10/include/linux/mount.h">include/linux/mount.h</a> 中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">vfsmount</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dentry</span> *<span class="title">mnt_root</span>;</span>	<span class="comment">/* root of the mounted tree */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">super_block</span> *<span class="title">mnt_sb</span>;</span>	<span class="comment">/* pointer to superblock */</span></span><br><span class="line">	<span class="keyword">int</span> mnt_flags;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>mnt_sb 指向所安装设备的超级块结构super_block。</li>
</ul>
<p>文件系统的安装选项，也就是vfsmount 结构中的安装标志mnt_flags在<a href="https://github.com/torvalds/linux/blob/v3.10/include/uapi/linux/fs.h#L62">include/uapi/linux/fs.h</a> 中，定义如下：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * These are the fs-independent mount-flags: up to 32 flags are supported</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_RDONLY	 1	<span class="comment">/* Mount read-only */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOSUID	 2	<span class="comment">/* Ignore suid and sgid bits */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NODEV	 4	<span class="comment">/* Disallow access to device special files */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOEXEC	 8	<span class="comment">/* Disallow program execution */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_SYNCHRONOUS	16	<span class="comment">/* Writes are synced at once */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_REMOUNT	32	<span class="comment">/* Alter flags of a mounted FS */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_MANDLOCK	64	<span class="comment">/* Allow mandatory locks on an FS */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_DIRSYNC	128	<span class="comment">/* Directory modifications are synchronous */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOATIME	1024	<span class="comment">/* Do not update access times. */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NODIRATIME	2048	<span class="comment">/* Do not update directory access times */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_BIND		4096</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_MOVE		8192</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_REC		16384</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_VERBOSE	32768	<span class="comment">/* War is peace. Verbosity is silence.</span></span></span><br><span class="line"><span class="meta"><span class="comment">				   MS_VERBOSE is deprecated. */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_SILENT	32768</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_POSIXACL	(1&lt;&lt;16)	<span class="comment">/* VFS does not apply the umask */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_UNBINDABLE	(1&lt;&lt;17)	<span class="comment">/* change to unbindable */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_PRIVATE	(1&lt;&lt;18)	<span class="comment">/* change to private */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_SLAVE	(1&lt;&lt;19)	<span class="comment">/* change to slave */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_SHARED	(1&lt;&lt;20)	<span class="comment">/* change to shared */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_RELATIME	(1&lt;&lt;21)	<span class="comment">/* Update atime relative to mtime/ctime. */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_KERNMOUNT	(1&lt;&lt;22) <span class="comment">/* this is a kern_mount call */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_I_VERSION	(1&lt;&lt;23) <span class="comment">/* Update inode I_version field */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_STRICTATIME	(1&lt;&lt;24) <span class="comment">/* Always perform atime updates */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* These sb flags are internal to the kernel */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOSEC	(1&lt;&lt;28)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_BORN		(1&lt;&lt;29)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_ACTIVE	(1&lt;&lt;30)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MS_NOUSER	(1&lt;&lt;31)</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li><strong>从定义可以看出，每个标志对应32 位中的一位。</strong></li>
<li>安装标志是针对整个文件系统中的所有文件的。例如，如果MS_NOSUID 标志为1，则整个文件系统中所有可执行文件的suid 标志位都不起作用了。</li>
</ul>
<h3 id="struct-mount结构"><a href="#struct-mount结构" class="headerlink" title="struct mount结构"></a><strong>struct mount结构</strong></h3><p>struct mount结构在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/mount.h#L27">linux/fs/mount.h</a>：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mount</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_hash</span>;</span>    <span class="comment">//安装点的哈希表</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mount</span> *<span class="title">mnt_parent</span>;</span>     <span class="comment">//是指向上一层安装点的指针</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dentry</span> *<span class="title">mnt_mountpoint</span>;</span> <span class="comment">//指向安装点dentry 结构的指针</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">vfsmount</span> <span class="title">mnt</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mnt_pcp</span> __<span class="title">percpu</span> *<span class="title">mnt_pcp</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	<span class="keyword">int</span> mnt_count;</span><br><span class="line">	<span class="keyword">int</span> mnt_writers;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_mounts</span>;</span>	<span class="comment">/* list of children, anchored here */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_child</span>;</span>	<span class="comment">/* and going through their mnt_child */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_instance</span>;</span>	<span class="comment">/* mount instance on sb-&gt;s_mounts */</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *mnt_devname;	<span class="comment">/* Name of device e.g. /dev/dsk/hda1 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_list</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_expire</span>;</span>	<span class="comment">/* link in fs-specific expiry list */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_share</span>;</span>	<span class="comment">/* circular list of shared mounts */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_slave_list</span>;</span><span class="comment">/* list of slave mounts */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mnt_slave</span>;</span>	<span class="comment">/* slave list entry */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mount</span> *<span class="title">mnt_master</span>;</span>	<span class="comment">/* slave is on master-&gt;mnt_slave_list */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mnt_namespace</span> *<span class="title">mnt_ns</span>;</span>	<span class="comment">/* containing namespace */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mountpoint</span> *<span class="title">mnt_mp</span>;</span>	<span class="comment">/* where is it mounted */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FSNOTIFY</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">hlist_head</span> <span class="title">mnt_fsnotify_marks</span>;</span></span><br><span class="line">	__u32 mnt_fsnotify_mask;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">int</span> mnt_id;			<span class="comment">/* mount identifier */</span></span><br><span class="line">	<span class="keyword">int</span> mnt_group_id;		<span class="comment">/* peer group identifier */</span></span><br><span class="line">	<span class="keyword">int</span> mnt_expiry_mark;		<span class="comment">/* true if marked for expiry */</span></span><br><span class="line">	<span class="keyword">int</span> mnt_pinned;</span><br><span class="line">	<span class="keyword">int</span> mnt_ghosts;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>mnt_hash：为了对系统中的所有安装点进行快速查找，内核把它们按哈希表来组织，mnt_hash就是形成哈希表的队列指针。</li>
<li>mnt_mountpoint： 是指向安装点dentry 结构的指针。而dentry 指针指向安装点所在目录树中根目录的dentry 结构。？</li>
<li>mnt_parent： 是指向上一层安装点的指针。如果当前的安装点没有上一层安装点（如根设备），则这个指针为NULL。</li>
<li>同时，vfsmount 结构中还有mnt_mounts 和mnt_child 两个队列头<ul>
<li>只要上一层vfsmount 结构存在，就把当前vfsmount 结构中mnt_child 链入上一层vfsmount 结构的mnt_mounts 队列中。这样就形成一个<strong>设备安装的树结构</strong>，从一个vfsmount结构的mnt_mounts 队列开始，可以找到所有直接或间接安装在这个安装点上的其他设备。</li>
</ul>
</li>
<li>mnt_list：是指向vfsmount结构所形成链表的头指针。</li>
</ul>
<p>另外，系统还定义了vfsmntlist 变量，指向mnt_list 队列。//在Linux kernel3.10 中没有vfsmntlist</p>
<h3 id="安装根文件系统"><a href="#安装根文件系统" class="headerlink" title="安装根文件系统"></a><strong>安装根文件系统</strong></h3><blockquote>
<p>每个文件系统都有它自己的根目录，如果某个文件系统（如Ext3）的根目录是系统目录树的根目录，那么该文件系统称为<code>根文件系统</code>。而其他文件系统可以安装在系统的目录树上，把这些文件系统要插入的那些目录就称为<code>安装点</code>。</p>
</blockquote>
<ul>
<li>当系统启动时，就要在<code>变量ROOT_DEV</code> 中寻找包含根文件系统的磁盘主码。</li>
<li>当编译内核或向最初的启动装入程序传递一个合适的选项时，根文件系统可以被指定为/dev 目录下的一个设备文件。</li>
<li>类似地，根文件系统的安装标志存放在<code>root_mountflags 变量</code>中。用户可以指定这些标志，这是通过对已编译的内核映像执行/sbin/rdev 外部程序，或者向最初的启动装入程序传递一个合适的选项来达到的。</li>
<li>根文件系统的安装函数为<code>mount_root()</code>。</li>
</ul>
<h3 id="安装一个常规文件系统"><a href="#安装一个常规文件系统" class="headerlink" title="安装一个常规文件系统"></a><strong>安装一个常规文件系统</strong></h3><p>一旦在系统中安装了根文件系统，就可以安装其他的文件系统。每个文件系统都可以安装在系统目录树中的一个目录上。</p>
<p>安装文件系统的两个系统的两种方式：</p>
<ul>
<li>以命令方式来安装文件系统，例如mount命令。</li>
<li>在用户程序中要安装一个文件系统则可以调用mount()系统调用。</li>
</ul>
<h3 id="sys-mount-函数"><a href="#sys-mount-函数" class="headerlink" title="sys_mount()函数"></a>sys_mount()函数</h3><p>mount()系统调用在内核的实现函数为<code>sys_mount()</code>，其函数定义使用SYSCALL_DEFINE定义，其代码在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L2503">fs/namespace.c</a> 中。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*sys_mount系统调用*/</span></span><br><span class="line"><span class="comment">/*	dev_name为待安装设备的路径名；</span></span><br><span class="line"><span class="comment">	dir_name为安装点的路径名；</span></span><br><span class="line"><span class="comment">	type是表示文件系统类型的字符串；</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">SYSCALL_DEFINE5(mount, <span class="keyword">char</span> __user *, dev_name, <span class="keyword">char</span> __user *, dir_name,</span><br><span class="line">		<span class="keyword">char</span> __user *, type, <span class="keyword">unsigned</span> <span class="keyword">long</span>, flags, <span class="keyword">void</span> __user *, data)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line">	<span class="keyword">char</span> *kernel_type;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">filename</span> *<span class="title">kernel_dir</span>;</span></span><br><span class="line">	<span class="keyword">char</span> *kernel_dev;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> data_page;</span><br><span class="line"></span><br><span class="line">	ret = copy_mount_string(type, &amp;kernel_type);</span><br><span class="line">	<span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> out_type;</span><br><span class="line"></span><br><span class="line">	kernel_dir = getname(dir_name);</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(kernel_dir)) &#123;</span><br><span class="line">		ret = PTR_ERR(kernel_dir);</span><br><span class="line">		<span class="keyword">goto</span> out_dir;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ret = copy_mount_string(dev_name, &amp;kernel_dev);</span><br><span class="line">	<span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> out_dev;</span><br><span class="line"></span><br><span class="line">	ret = copy_mount_options(data, &amp;data_page);</span><br><span class="line">	<span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> out_data;</span><br><span class="line"></span><br><span class="line">	ret = do_mount(kernel_dev, kernel_dir-&gt;name, kernel_type, flags,</span><br><span class="line">		(<span class="keyword">void</span> *) data_page);</span><br><span class="line"></span><br><span class="line">	free_page(data_page);</span><br><span class="line">out_data:</span><br><span class="line">	kfree(kernel_dev);</span><br><span class="line">out_dev:</span><br><span class="line">	putname(kernel_dir);</span><br><span class="line">out_dir:</span><br><span class="line">	kfree(kernel_type);</span><br><span class="line">out_type:</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>dev_name为待安装文件系统所在设备的路径名，如果不需要就为空（例如，当待安装的是基于网络的文件系统时）；</li>
<li>dir_name 则是安装点（空闲目录）的路径名；</li>
<li>type 是文件系统的类型，必须是已注册文件系统的字符串名（如“Ext3”）</li>
<li>flags是安装模式，如前面所述。</li>
<li>data 指向一个与文件系统相关的数据结构（可以为NULL）。</li>
<li>copy_mount_options()和getname()函数将结构形式或字符串形式的参数值从用户空间拷贝到内核空间。<ul>
<li>这些参数值的长度均以一个页面为限，但是getname()在复制时遇到字符串结尾符“\0”就停止，并返回指向该字符串的指针；</li>
<li>而copy_mount_options()则拷贝整个页面，并返回该页面的起始地址。</li>
</ul>
</li>
<li>该函数调用的主要函数为do_mount()，do_mount()执行期间要加内核锁，不过这个锁是针对SMP，我们暂不考虑。</li>
</ul>
<p><code>do_mount()</code>的实现代码在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L2247">fs/namespace.c</a>中：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Flags is a 32-bit value that allows up to 31 non-fs dependent flags to</span></span><br><span class="line"><span class="comment"> * be given to the mount() call (ie: read-only, no-dev, no-suid etc).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * data is a (void *) that can point to any structure up to</span></span><br><span class="line"><span class="comment"> * PAGE_SIZE-1 bytes, which can contain arbitrary fs-dependent</span></span><br><span class="line"><span class="comment"> * information (or be NULL).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Pre-0.97 versions of mount() didn't have a flags word.</span></span><br><span class="line"><span class="comment"> * When the flags word was introduced its top half was required</span></span><br><span class="line"><span class="comment"> * to have the magic value 0xC0ED, and this remained so until 2.4.0-test9.</span></span><br><span class="line"><span class="comment"> * Therefore, if this magic number is present, it carries no information</span></span><br><span class="line"><span class="comment"> * and must be discarded.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">do_mount</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *dev_name, <span class="keyword">const</span> <span class="keyword">char</span> *dir_name,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">const</span> <span class="keyword">char</span> *type_page, <span class="keyword">unsigned</span> <span class="keyword">long</span> flags, <span class="keyword">void</span> *data_page)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">path</span> <span class="title">path</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> mnt_flags = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Discard magic */</span></span><br><span class="line">	<span class="keyword">if</span> ((flags &amp; MS_MGC_MSK) == MS_MGC_VAL)</span><br><span class="line">		flags &amp;= ~MS_MGC_MSK;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Basic sanity checks */</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!dir_name || !*dir_name || !<span class="built_in">memchr</span>(dir_name, <span class="number">0</span>, PAGE_SIZE))</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (data_page)</span><br><span class="line">		((<span class="keyword">char</span> *)data_page)[PAGE_SIZE - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* ... and get the mountpoint */</span></span><br><span class="line">	retval = kern_path(dir_name, LOOKUP_FOLLOW, &amp;path);</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">return</span> retval;</span><br><span class="line"></span><br><span class="line">	retval = security_sb_mount(dev_name, &amp;path,</span><br><span class="line">				   type_page, flags, data_page);</span><br><span class="line">	<span class="keyword">if</span> (!retval &amp;&amp; !may_mount())</span><br><span class="line">		retval = -EPERM;</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">goto</span> dput_out;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Default to relatime unless overriden */</span></span><br><span class="line">	<span class="keyword">if</span> (!(flags &amp; MS_NOATIME))</span><br><span class="line">		mnt_flags |= MNT_RELATIME;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Separate the per-mountpoint flags */</span></span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NOSUID)</span><br><span class="line">		mnt_flags |= MNT_NOSUID;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NODEV)</span><br><span class="line">		mnt_flags |= MNT_NODEV;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NOEXEC)</span><br><span class="line">		mnt_flags |= MNT_NOEXEC;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NOATIME)</span><br><span class="line">		mnt_flags |= MNT_NOATIME;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_NODIRATIME)</span><br><span class="line">		mnt_flags |= MNT_NODIRATIME;</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_STRICTATIME)</span><br><span class="line">		mnt_flags &amp;= ~(MNT_RELATIME | MNT_NOATIME);</span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_RDONLY)</span><br><span class="line">		mnt_flags |= MNT_READONLY;</span><br><span class="line"></span><br><span class="line">	flags &amp;= ~(MS_NOSUID | MS_NOEXEC | MS_NODEV | MS_ACTIVE | MS_BORN |</span><br><span class="line">		   MS_NOATIME | MS_NODIRATIME | MS_RELATIME| MS_KERNMOUNT |</span><br><span class="line">		   MS_STRICTATIME);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_REMOUNT)</span><br><span class="line">		retval = do_remount(&amp;path, flags &amp; ~MS_REMOUNT, mnt_flags,</span><br><span class="line">				    data_page);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (flags &amp; MS_BIND)</span><br><span class="line">		retval = do_loopback(&amp;path, dev_name, flags &amp; MS_REC);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (flags &amp; (MS_SHARED | MS_PRIVATE | MS_SLAVE | MS_UNBINDABLE))</span><br><span class="line">		retval = do_change_type(&amp;path, flags);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (flags &amp; MS_MOVE)</span><br><span class="line">		retval = do_move_mount(&amp;path, dev_name);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		retval = do_new_mount(&amp;path, type_page, flags, mnt_flags,</span><br><span class="line">				      dev_name, data_page);</span><br><span class="line">dput_out:</span><br><span class="line">	path_put(&amp;path);</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对函数中的主要代码给予说明:</p>
<ul>
<li>对参数dir_name 和dev_name 进行基本检查，注意“！dir_name ” 和“!*dir_name”的不同，前者指指向字符串的指针为不为空，而后者指字符串不为空。memchr()函数在指定长度的字符串中寻找指定的字符，如果字符串中没有结尾符“\0”，也是一种错误。前面已说过，对于基于网络的文件系统dev_name 可以为空。</li>
<li>把安装标志为MS_NOSUID、MS_NOEXEC 和MS_NODEV 的3个标志位从flags 分离出来，放在局部安装标志变量mnt_flags 中。</li>
<li>如果flags 中的MS_REMOUNT 标志位为1，就表示所要求的只是改变一个原已安装设备的安装方式，例如从“只读“安装方式改为“可写”安装方式，这是通过调用<code>do_remount()</code>函数完成的。</li>
<li>如果flags 中的MS_BIND 标志位为1，就表示把一个“回接”设备捆绑到另一个对象上。<ul>
<li>回接设备是一种特殊的设备（虚拟设备），而实际上并不是一种真正设备，而是一种机制，这种机制提供了把回接设备回接到某个可访问的常规文件或块设备的手段。通常在/dev目录中有/dev/loop0 和/dev/loop1 两个回接设备文件。调用<code>do_loopback()</code>来实现回接设备的安装。</li>
</ul>
</li>
<li>如果flags 中的MS_MOVE 标志位为1，就表示把一个已安装的设备可以移到另一个安装点，这是通过调用<code>do_move_mount()</code>函数来实现的。</li>
<li>如果不是以上3 种情况，那就是一般的安装请求，于是把安装点加入到目录树中，这是通过调用<code>do_new_mount()函数</code>来实现的，而do_new_mount()首先调用<code>vfs_kern_mount函数</code>形成一个安装点。do_new_mount()函数也调用了</li>
</ul>
<p><code>do_new_mount()函数</code>的代码在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L1969">fs/namespace.c</a> 中：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * create a new mount for userspace and request it to be added into the</span></span><br><span class="line"><span class="comment"> * namespace's tree</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">do_new_mount</span><span class="params">(struct path *path, <span class="keyword">const</span> <span class="keyword">char</span> *fstype, <span class="keyword">int</span> flags,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">int</span> mnt_flags, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">void</span> *data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_system_type</span> *<span class="title">type</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">user_namespace</span> *<span class="title">user_ns</span> = <span class="title">current</span>-&gt;<span class="title">nsproxy</span>-&gt;<span class="title">mnt_ns</span>-&gt;<span class="title">user_ns</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">vfsmount</span> *<span class="title">mnt</span>;</span></span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!fstype)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	type = get_fs_type(fstype);</span><br><span class="line">	<span class="keyword">if</span> (!type)</span><br><span class="line">		<span class="keyword">return</span> -ENODEV;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (user_ns != &amp;init_user_ns) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!(type-&gt;fs_flags &amp; FS_USERNS_MOUNT)) &#123;</span><br><span class="line">			put_filesystem(type);</span><br><span class="line">			<span class="keyword">return</span> -EPERM;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/* Only in special cases allow devices from mounts</span></span><br><span class="line"><span class="comment">		 * created outside the initial user namespace.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (!(type-&gt;fs_flags &amp; FS_USERNS_DEV_MOUNT)) &#123;</span><br><span class="line">			flags |= MS_NODEV;</span><br><span class="line">			mnt_flags |= MNT_NODEV;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	mnt = vfs_kern_mount(type, flags, name, data);</span><br><span class="line">	<span class="keyword">if</span> (!IS_ERR(mnt) &amp;&amp; (type-&gt;fs_flags &amp; FS_HAS_SUBTYPE) &amp;&amp;</span><br><span class="line">	    !mnt-&gt;mnt_sb-&gt;s_subtype)</span><br><span class="line">		mnt = fs_set_subtype(mnt, fstype);</span><br><span class="line"></span><br><span class="line">	put_filesystem(type);</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(mnt))</span><br><span class="line">		<span class="keyword">return</span> PTR_ERR(mnt);</span><br><span class="line"></span><br><span class="line">	err = do_add_mount(real_mount(mnt), path, mnt_flags);</span><br><span class="line">	<span class="keyword">if</span> (err)</span><br><span class="line">		mntput(mnt);</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对函数中的主要代码给予说明:</p>
<ul>
<li>只有系统管理员才具有安装一个设备的权力，因此首先要检查当前进程是否具有这种权限。</li>
<li>get_fs_type()函数根据具体文件系统的类型名在file_system_file 链表中找到相应的结构。</li>
</ul>
<p><code>vfs_kern_mount()函数</code>代码在<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L774">fs/namespace.c</a> 中：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">vfsmount</span> *</span></span><br><span class="line"><span class="class"><span class="title">vfs_kern_mount</span>(<span class="title">struct</span> <span class="title">file_system_type</span> *<span class="title">type</span>, <span class="title">int</span> <span class="title">flags</span>, <span class="title">const</span> <span class="title">char</span> *<span class="title">name</span>, <span class="title">void</span> *<span class="title">data</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mount</span> *<span class="title">mnt</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dentry</span> *<span class="title">root</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!type)</span><br><span class="line">		<span class="keyword">return</span> ERR_PTR(-ENODEV);</span><br><span class="line"></span><br><span class="line">	mnt = alloc_vfsmnt(name);</span><br><span class="line">	<span class="keyword">if</span> (!mnt)</span><br><span class="line">		<span class="keyword">return</span> ERR_PTR(-ENOMEM);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (flags &amp; MS_KERNMOUNT)</span><br><span class="line">		mnt-&gt;mnt.mnt_flags = MNT_INTERNAL;</span><br><span class="line"></span><br><span class="line">	root = mount_fs(type, flags, name, data);</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(root)) &#123;</span><br><span class="line">		free_vfsmnt(mnt);</span><br><span class="line">		<span class="keyword">return</span> ERR_CAST(root);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	mnt-&gt;mnt.mnt_root = root;</span><br><span class="line">	mnt-&gt;mnt.mnt_sb = root-&gt;d_sb;</span><br><span class="line">	mnt-&gt;mnt_mountpoint = mnt-&gt;mnt.mnt_root;</span><br><span class="line">	mnt-&gt;mnt_parent = mnt;</span><br><span class="line">	br_write_lock(&amp;vfsmount_lock);</span><br><span class="line">	list_add_tail(&amp;mnt-&gt;mnt_instance, &amp;root-&gt;d_sb-&gt;s_mounts);</span><br><span class="line">	br_write_unlock(&amp;vfsmount_lock);</span><br><span class="line">	<span class="keyword">return</span> &amp;mnt-&gt;mnt;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(vfs_kern_mount);</span><br></pre></td></tr></table></figure>
<ul>
<li>alloc_vfsmnt（）函数调用slab 分配器给类型为vfsmount 结构的局部变量mnt 分配空间，并进行相应的初始化。</li>
</ul>
<p><code>do_add_mount()函数</code>代码，<a href="https://github.com/torvalds/linux/blob/v3.10/fs/namespace.c#L1924">fs/namespace.c</a> 中：</p>
<figure class="highlight c"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * add a mount into a namespace's mount tree</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">do_add_mount</span><span class="params">(struct mount *newmnt, struct path *path, <span class="keyword">int</span> mnt_flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mountpoint</span> *<span class="title">mp</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mount</span> *<span class="title">parent</span>;</span></span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	mnt_flags &amp;= ~(MNT_SHARED | MNT_WRITE_HOLD | MNT_INTERNAL);</span><br><span class="line"></span><br><span class="line">	mp = lock_mount(path);</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(mp))</span><br><span class="line">		<span class="keyword">return</span> PTR_ERR(mp);</span><br><span class="line"></span><br><span class="line">	parent = real_mount(path-&gt;mnt);</span><br><span class="line">	err = -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> (unlikely(!check_mnt(parent))) &#123;</span><br><span class="line">		<span class="comment">/* that's acceptable only for automounts done in private ns */</span></span><br><span class="line">		<span class="keyword">if</span> (!(mnt_flags &amp; MNT_SHRINKABLE))</span><br><span class="line">			<span class="keyword">goto</span> unlock;</span><br><span class="line">		<span class="comment">/* ... and for those we'd better have mountpoint still alive */</span></span><br><span class="line">		<span class="keyword">if</span> (!parent-&gt;mnt_ns)</span><br><span class="line">			<span class="keyword">goto</span> unlock;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Refuse the same filesystem on the same mount point */</span></span><br><span class="line">	err = -EBUSY;</span><br><span class="line">	<span class="keyword">if</span> (path-&gt;mnt-&gt;mnt_sb == newmnt-&gt;mnt.mnt_sb &amp;&amp;</span><br><span class="line">	    path-&gt;mnt-&gt;mnt_root == path-&gt;dentry)</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	err = -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> (S_ISLNK(newmnt-&gt;mnt.mnt_root-&gt;d_inode-&gt;i_mode))</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	newmnt-&gt;mnt.mnt_flags = mnt_flags;</span><br><span class="line">	err = graft_tree(newmnt, parent, mp);</span><br><span class="line"></span><br><span class="line">unlock:</span><br><span class="line">	unlock_mount(mp);</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文件系统的卸载"><a href="#文件系统的卸载" class="headerlink" title="文件系统的卸载"></a><strong>文件系统的卸载</strong></h2><p>如果文件系统中的文件当前正在使用，该文件系统是不能被卸载的。<br>如果文件系统中的文件或目录正在使用，则 VFS 索引节点高速缓存中可能包含相应的 VFS 索引节点。<br>根据文件系统所在设备的标识符，检查在索引节点高速缓存中是否有来自该文件系统的 VFS 索引节点，如果有且使用计数大于0，则说明该文件系统正在被使用，因此，该文件系统不能被卸<br>载。否则，查看对应的 VFS 超级块，如果该文件系统的 VFS 超级块标志为“脏”，则必须将超级块信息写回磁盘。<br>上述过程结束之后，对应的 VFS 超级块被释放，vfsmount 数据结构将从vfsmntlist链表中断开并被释放。<br>具体的实现代码为fs/super.c 中的sys_umount()函数。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a><strong>参考资料</strong></h2><p>《深入分析Linux内核源代码》 //书籍内核版本有些旧<br><a href="https://www.ibm.com/developerworks/cn/linux/l-lpic1-v3-104-3/index.html">控制文件系统的安装和卸载</a><br><a href="http://tjpm.blog.chinaunix.net/uid-27007072-id-3336479.html">文件系统的注册与注销、安装与卸载</a><br><a href="https://zhuanlan.zhihu.com/p/36240056">文件系统怎么让Linux内核认识自己</a><br><a href="https://zhuanlan.zhihu.com/p/36268333">mount系统调用初探</a></p>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a><strong>注解</strong></h2><p>uapi文件夹：（the user space API of the kernel，Then upon kernel installation, the uapi include files become the top level /usr/include/linux/ files.）Linux Kernel 中新增的这些 uapi 头文件，其实都是来自于各个模块原先的头文件，最先是由 David Howells 提出来的。uapi 只是把内核用到的头文件和用户态用到的头文件分开。<br>Linux的系统调用都改为SYSCALL_DEFINE定义,原因参照：<a href="https://blog.csdn.net/hxmhyp/article/details/22699669">Linux系统调用之SYSCALL_DEFINE</a>。</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/Linux/" rel="tag">Linux</a>, <a class="has-link-grey -link" href="/tags/%E5%86%85%E6%A0%B8/" rel="tag">内核</a>, <a class="has-link-grey -link" href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" rel="tag">文件系统</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2020/08/17/Linux-%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Linux-块设备驱动程序</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2020/08/12/Linux-VFS%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
                <span class="level-item">Linux-VFS中的数据结构</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">评论</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.min.js"></script>
<script>
    var gitalk = new Gitalk({
        clientID: 'e79770cfee30db02a856',
        clientSecret: 'bb958f5fc30797ffc222ca631ec345baa48a0bee',
        id: '7a711ed606220788332c6364228afcf0',
        repo: 'STEMHA.github.io',
        owner: 'STEMHA',
        admin: "STEMHA",
        createIssueManually: false,
        distractionFreeMode: false
    })
    gitalk.render('comment-container')
</script>

    </div>
</div>
</div>
				 
				
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/og_image.png" alt="Linux文件系统注册、安装与卸载" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 STEMHA&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://stemha.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    	

</body>
</html>